import { __decorate, __metadata } from "tslib";
import { Attribute, ChangeDetectorRef, ComponentFactoryResolver, ComponentRef, Directive, Inject, Injector, EventEmitter, Output, ViewContainerRef, ElementRef, InjectFlags, NgZone, EnvironmentInjector } from '@angular/core';
import { ActivatedRoute, ChildrenOutletContexts, PRIMARY_OUTLET, Router } from '@angular/router';
import { Frame, Page, profile } from '@nativescript/core';
import { BehaviorSubject } from 'rxjs';
import { PAGE_FACTORY } from '../../tokens';
import { NativeScriptDebug } from '../../trace';
import { DetachedLoader } from '../../cdk/detached-loader';
import { ViewUtil } from '../../view-util';
import { NSLocationStrategy } from './ns-location-strategy';
import { defaultNavOptions } from './ns-location-utils';
import { NSRouteReuseStrategy } from './ns-route-reuse-strategy';
import { findTopActivatedRouteNodeForOutlet, pageRouterActivatedSymbol, loaderRefSymbol, destroyComponentRef } from './page-router-outlet-utils';
import { registerElement } from '../../element-registry';
import { PageService } from '../../cdk/frame-page/page.service';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "./ns-location-strategy";
import * as i3 from "./ns-route-reuse-strategy";
import * as i4 from "../../view-util";
export class PageRoute {
    constructor(startRoute) {
        this.activatedRoute = new BehaviorSubject(startRoute);
    }
}
function isComponentFactoryResolver(item) {
    return !!item.resolveComponentFactory;
}
function callableOnce(fn) {
    let called = false;
    return (...args) => {
        if (called) {
            return;
        }
        called = true;
        return fn(...args);
    };
}
export class DestructibleInjector {
    constructor(destructibleProviders, parent) {
        this.destructibleProviders = destructibleProviders;
        this.parent = parent;
        this.refs = new Set();
    }
    get(token, notFoundValue, flags) {
        const ref = this.parent.get(token, notFoundValue, flags);
        // if we're skipping ourselves then it's not our responsibility to destroy
        if (typeof flags === 'number') {
            if (!(flags & InjectFlags.SkipSelf) && this.destructibleProviders.has(token)) {
                this.refs.add(ref);
            }
        }
        else {
            if (!flags?.skipSelf && this.destructibleProviders.has(token)) {
                this.refs.add(ref);
            }
        }
        return ref;
    }
    destroy() {
        this.refs.forEach((ref) => {
            if (ref.ngOnDestroy instanceof Function) {
                ref.ngOnDestroy();
            }
        });
        this.refs.clear();
    }
}
const routeToString = function (activatedRoute) {
    return activatedRoute.pathFromRoot.join('->');
};
registerElement('page-router-outlet', () => Frame);
// eslint-disable-next-line @angular-eslint/directive-selector
export class PageRouterOutlet {
    /** @deprecated from Angular since v4 */
    get locationInjector() {
        return this.location.injector;
    }
    /** @deprecated from Angular since v4 */
    get locationFactoryResolver() {
        return this.resolver;
    }
    get isActivated() {
        return !!this.activated;
    }
    get component() {
        if (!this.activated) {
            if (NativeScriptDebug.isLogEnabled()) {
                NativeScriptDebug.routerLog('Outlet is not activated');
            }
            return;
        }
        return this.activated.instance;
    }
    get activatedRoute() {
        if (!this.activated) {
            if (NativeScriptDebug.isLogEnabled()) {
                NativeScriptDebug.routerLog('Outlet is not activated');
            }
            return;
        }
        return this._activatedRoute;
    }
    get activatedRouteData() {
        if (this._activatedRoute) {
            return this._activatedRoute.snapshot.data;
        }
        return {};
    }
    constructor(parentContexts, location, name, actionBarVisibility, isEmptyOutlet, locationStrategy, componentFactoryResolver, resolver, changeDetector, pageFactory, routeReuseStrategy, ngZone, router, elRef, viewUtil, environmentInjector) {
        this.parentContexts = parentContexts;
        this.location = location;
        this.locationStrategy = locationStrategy;
        this.componentFactoryResolver = componentFactoryResolver;
        this.resolver = resolver;
        this.changeDetector = changeDetector;
        this.pageFactory = pageFactory;
        this.routeReuseStrategy = routeReuseStrategy;
        this.ngZone = ngZone;
        this.router = router;
        this.environmentInjector = environmentInjector;
        // tslint:disable-line:directive-class-suffix
        this.activated = null;
        this._activatedRoute = null;
        this.attachEvents = new EventEmitter();
        this.detachEvents = new EventEmitter();
        // eslint-disable-next-line @angular-eslint/no-output-rename
        this.activateEvents = new EventEmitter(); // tslint:disable-line:no-output-rename
        // eslint-disable-next-line @angular-eslint/no-output-rename
        this.deactivateEvents = new EventEmitter(); // tslint:disable-line:no-output-rename
        this.isEmptyOutlet = isEmptyOutlet;
        this.frame = elRef.nativeElement;
        this.setActionBarVisibility(actionBarVisibility);
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog(`PageRouterOutlet.constructor frame: ${this.frame}`);
        }
        this.name = name || PRIMARY_OUTLET;
        parentContexts.onChildOutletCreated(this.name, this);
        this.viewUtil = viewUtil;
        this.detachedLoaderFactory = resolver.resolveComponentFactory(DetachedLoader);
    }
    setActionBarVisibility(actionBarVisibility) {
        switch (actionBarVisibility) {
            case 'always':
            case 'never':
                this.frame.actionBarVisibility = actionBarVisibility;
                return;
            default:
                this.frame.actionBarVisibility = 'auto';
        }
    }
    ngOnDestroy() {
        // In the event that the `parentContexts` has changed the outlet
        // via the creation of another outlet, the `onChildOutletDestroyed`
        // will be skipped
        if (this.parentContexts.getContext(this.name)?.outlet === this) {
            // Clear accumulated modal view page cache when page-router-outlet
            // destroyed on modal view closing
            this.parentContexts.onChildOutletDestroyed(this.name);
        }
        if (this.outlet) {
            this.outlet.outletKeys.forEach((key) => {
                this.routeReuseStrategy.clearModalCache(key);
            });
            this.locationStrategy.clearOutlet(this.frame);
        }
        else {
            NativeScriptDebug.routerLog('PageRouterOutlet.ngOnDestroy: no outlet available for page-router-outlet');
        }
        if (this.isActivated) {
            const c = this.activated.instance;
            this.activated.hostView.detach();
            destroyComponentRef(this.activated);
            this.deactivateEvents.emit(c);
            this.activated = null;
        }
    }
    deactivate() {
        if (!this.outlet || !this.outlet.isPageNavigationBack) {
            if (NativeScriptDebug.isLogEnabled()) {
                NativeScriptDebug.routerLog('Currently not in page back navigation - component should be detached instead of deactivated.');
            }
            return;
        }
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog('PageRouterOutlet.deactivate() while going back - should destroy');
        }
        if (!this.isActivated) {
            return;
        }
        this.postNavFunction?.();
        const c = this.activated.instance;
        destroyComponentRef(this.activated);
        this.activated = null;
        this._activatedRoute = null;
        this.deactivateEvents.emit(c);
    }
    /**
     * Called when the `RouteReuseStrategy` instructs to detach the subtree
     */
    detach() {
        if (!this.isActivated) {
            if (NativeScriptDebug.isLogEnabled()) {
                NativeScriptDebug.routerLog('Outlet is not activated');
            }
            return;
        }
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog(`PageRouterOutlet.detach() - ${routeToString(this._activatedRoute)}`);
        }
        this.postNavFunction?.();
        // Detach from ChangeDetection
        this.activated.hostView.detach();
        const component = this.activated;
        this.activated = null;
        this._activatedRoute = null;
        this.detachEvents.emit(component.instance);
        return component;
    }
    /**
     * Called when the `RouteReuseStrategy` instructs to re-attach a previously detached subtree
     */
    attach(ref, activatedRoute) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog(`PageRouterOutlet.attach() - ${routeToString(activatedRoute)}`);
        }
        this.activated = ref;
        // reattach to ChangeDetection
        this.activated.hostView.markForCheck();
        this.activated.hostView.reattach();
        this._activatedRoute = activatedRoute;
        this.markActivatedRoute(activatedRoute);
        // we have a child with the same name, so we don't finish the back nav
        if (this.isFinalPageRouterOutlet()) {
            this.locationStrategy._finishBackPageNavigation(this.frame);
        }
        this.attachEvents.emit(ref.instance);
    }
    isFinalPageRouterOutlet() {
        let children = this.parentContexts.getContext(this.name)?.children;
        while (children) {
            const childContext = children.getContext(this.name);
            if (!childContext || !childContext.outlet) {
                return true;
            }
            if (childContext.outlet instanceof PageRouterOutlet) {
                return false;
            }
            children = childContext.children;
        }
        return true;
    }
    /**
     * Called by the Router to instantiate a new component during the commit phase of a navigation.
     * This method in turn is responsible for calling the `routerOnActivate` hook of its child.
     */
    activateWith(activatedRoute, resolver) {
        this.outlet = this.outlet || this.getOutlet(activatedRoute.snapshot);
        if (!this.outlet) {
            if (NativeScriptDebug.isLogEnabled()) {
                NativeScriptDebug.routerError('No outlet found relative to activated route');
            }
            return;
        }
        this.outlet.isNSEmptyOutlet = this.isEmptyOutlet;
        this.locationStrategy.updateOutletFrame(this.outlet, this.frame, this.isEmptyOutlet);
        if (this.outlet && this.outlet.isPageNavigationBack) {
            if (NativeScriptDebug.isLogEnabled()) {
                NativeScriptDebug.routerLog('Currently in page back navigation - component should be reattached instead of activated.');
            }
            if (this.isFinalPageRouterOutlet()) {
                this.locationStrategy._finishBackPageNavigation(this.frame);
            }
        }
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog(`PageRouterOutlet.activateWith() - ${routeToString(activatedRoute)}`);
        }
        this._activatedRoute = activatedRoute;
        this.markActivatedRoute(activatedRoute);
        this.activateOnGoForward(activatedRoute, resolver || this.environmentInjector);
        this.activateEvents.emit(this.activated.instance);
    }
    activateOnGoForward(activatedRoute, resolverOrInjector) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog('PageRouterOutlet.activate() forward navigation - ' + 'create detached loader in the loader container');
        }
        const component = this.getComponentType(activatedRoute);
        const page = this.pageFactory({
            isNavigation: true,
            componentType: component,
        });
        const location = this.location;
        const destructibles = new Set([PageService]);
        const parentInjector = Injector.create({
            providers: [
                { provide: Page, useValue: page },
                { provide: Frame, useValue: this.frame },
                { provide: PageRoute, useValue: new PageRoute(activatedRoute) },
                { provide: ActivatedRoute, useValue: activatedRoute },
                { provide: ChildrenOutletContexts, useValue: this.parentContexts.getOrCreateContext(this.name).children },
                { provide: PageService, useClass: PageService },
            ],
            parent: location.injector,
        });
        const injector = new DestructibleInjector(destructibles, parentInjector);
        let loaderRef;
        if (isComponentFactoryResolver(resolverOrInjector)) {
            const factory = resolverOrInjector.resolveComponentFactory(DetachedLoader);
            loaderRef = location.createComponent(factory, location.length, injector);
        }
        else {
            const environmentInjector = resolverOrInjector;
            loaderRef = location.createComponent(DetachedLoader, { index: location.length, injector, environmentInjector });
        }
        loaderRef.onDestroy(() => injector.destroy());
        this.changeDetector.markForCheck();
        this.activated = loaderRef.instance.loadComponentInLocation(component);
        this.activated.changeDetectorRef.detectChanges();
        this.loadComponentInPage(page, this.activated, { activatedRoute });
        this.activated[loaderRefSymbol] = loaderRef;
    }
    loadComponentInPage(page, componentRef, navigationContext) {
        // Component loaded. Find its root native view.
        const componentView = componentRef.location.nativeElement;
        // Remove it from original native parent.
        this.viewUtil.removeChild(componentView.parent, componentView);
        // Add it to the new page
        this.viewUtil.appendChild(page, componentView);
        let topActivatedRoute = findTopActivatedRouteNodeForOutlet(this._activatedRoute.snapshot);
        let outletKey = this.locationStrategy.getRouteFullPath(topActivatedRoute);
        const thisRouteKey = outletKey;
        while (!this.locationStrategy.findOutlet(outletKey)) {
            topActivatedRoute = topActivatedRoute.parent;
            if (!topActivatedRoute) {
                NativeScriptDebug.routerError('Could not find outlet for route: ' + thisRouteKey);
                break;
            }
            outletKey = this.locationStrategy.getRouteFullPath(topActivatedRoute);
        }
        const navigatedFromCallback = global.Zone.current.wrap((args) => {
            if (args.isBackNavigation) {
                this.locationStrategy._beginBackPageNavigation(this.frame, outletKey);
                this.locationStrategy.back(null, this.frame);
            }
        });
        // TODO: experiment with using NgZone instead of global above
        // const navigatedFromCallback = (args: NavigatedData) => {
        // 	if (args.isBackNavigation) {
        //     this.ngZone.run(() => {
        //       this.locationStrategy._beginBackPageNavigation(this.frame);
        //       this.locationStrategy.back(null, this.frame);
        //     });
        // 	}
        // };
        page.on(Page.navigatedFromEvent, navigatedFromCallback);
        componentRef.onDestroy(() => {
            if (page) {
                page.off(Page.navigatedFromEvent, navigatedFromCallback);
                page = null;
            }
        });
        const navOptions = { ...defaultNavOptions, ...(this.router.getCurrentNavigation().extras || {}) };
        this.locationStrategy._beginPageNavigation(this.frame, navOptions);
        const isReplace = navOptions.replaceUrl && !navOptions.clearHistory;
        const currentRoute = this.activatedRoute;
        // Clear refCache if navigation with clearHistory
        if (navOptions.clearHistory) {
            this.outlet.outletKeys.forEach((key) => this.routeReuseStrategy.markCacheForClear(key));
            const wipeCache = callableOnce(() => {
                if (this.postNavFunction === wipeCache) {
                    this.postNavFunction = null;
                }
                if (this.outlet && this.activatedRoute === currentRoute) {
                    // potential alternative fix (only fix children of the current outlet)
                    // const nests = outletKey.split('/');
                    // this.outlet.outletKeys.filter((k) => k.split('/').length >= nests.length).forEach((key) => this.routeReuseStrategy.clearCache(key));
                    this.outlet.outletKeys.forEach((key) => this.routeReuseStrategy.clearMarkedCache(key));
                }
            });
            this.postNavFunction = wipeCache;
            const clearCallback = () => setTimeout(() => {
                wipeCache();
            });
            page.once(Page.navigatedToEvent, clearCallback);
        }
        else if (navOptions.replaceUrl) {
            this.outlet.outletKeys.forEach((key) => this.routeReuseStrategy.markCacheForPop(key));
            const popCache = callableOnce(() => {
                if (this.postNavFunction === popCache) {
                    this.postNavFunction = null;
                }
                if (this.outlet && this.activatedRoute === currentRoute) {
                    // potential alternative fix (only fix children of the current outlet)
                    // const nests = outletKey.split('/');
                    // this.outlet.outletKeys.filter((k) => k.split('/').length >= nests.length).forEach((key) => this.routeReuseStrategy.popCache(key));
                    this.outlet.outletKeys.forEach((key) => this.routeReuseStrategy.clearMarkedCache(key));
                }
            });
            this.postNavFunction = popCache;
            const clearCallback = () => setTimeout(() => {
                popCache();
            });
            page.once(Page.navigatedToEvent, clearCallback);
        }
        const navigationEntry = {
            create() {
                return page;
            },
            context: navigationContext,
            clearHistory: navOptions.clearHistory,
            animated: navOptions.animated,
            transition: navOptions.transition,
        };
        if (isReplace && this.frame.currentPage) {
            this.frame.replacePage(navigationEntry);
        }
        else {
            this.frame.navigate(navigationEntry);
        }
    }
    // Find and mark the top activated route as an activated one.
    // In ns-location-strategy we are reusing components only if their corresponing routes
    // are marked as activated from this method.
    markActivatedRoute(activatedRoute) {
        const queue = [];
        queue.push(activatedRoute.snapshot);
        let currentRoute = queue.shift();
        while (currentRoute) {
            currentRoute.children.forEach((childRoute) => {
                queue.push(childRoute);
            });
            const topActivatedRoute = findTopActivatedRouteNodeForOutlet(currentRoute);
            const outletKey = this.locationStrategy.getRouteFullPath(topActivatedRoute);
            const outlet = this.locationStrategy.findOutlet(outletKey, topActivatedRoute);
            if (outlet && outlet.frames.length) {
                topActivatedRoute[pageRouterActivatedSymbol] = true;
                if (NativeScriptDebug.isLogEnabled()) {
                    NativeScriptDebug.routerLog('Activated route marked as page: ' + routeToString(topActivatedRoute));
                }
            }
            currentRoute = queue.shift();
        }
    }
    getComponentType(activatedRoute) {
        return activatedRoute.routeConfig.component || activatedRoute.component;
    }
    getOutlet(activatedRouteSnapshot) {
        const topActivatedRoute = findTopActivatedRouteNodeForOutlet(activatedRouteSnapshot);
        const outletKey = this.locationStrategy.getRouteFullPath(topActivatedRoute);
        let outlet = this.locationStrategy.findOutlet(outletKey, topActivatedRoute);
        // Named lazy loaded outlet.
        if (!outlet && this.isEmptyOutlet) {
            const parentOutletKey = this.locationStrategy.getRouteFullPath(topActivatedRoute.parent);
            outlet = this.locationStrategy.findOutlet(parentOutletKey, topActivatedRoute.parent);
            if (outlet) {
                outlet.outletKeys.push(outletKey);
            }
        }
        return outlet;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.1.0", ngImport: i0, type: PageRouterOutlet, deps: [{ token: i1.ChildrenOutletContexts }, { token: i0.ViewContainerRef }, { token: 'name', attribute: true }, { token: 'actionBarVisibility', attribute: true }, { token: 'isEmptyOutlet', attribute: true }, { token: i2.NSLocationStrategy }, { token: i0.ComponentFactoryResolver }, { token: i0.ComponentFactoryResolver }, { token: i0.ChangeDetectorRef }, { token: PAGE_FACTORY }, { token: i3.NSRouteReuseStrategy }, { token: i0.NgZone }, { token: i1.Router }, { token: i0.ElementRef }, { token: i4.ViewUtil }, { token: i0.EnvironmentInjector }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "18.1.0", type: PageRouterOutlet, isStandalone: true, selector: "page-router-outlet", outputs: { activateEvents: "activate", deactivateEvents: "deactivate" }, ngImport: i0 }); }
}
__decorate([
    profile,
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [ActivatedRoute, Object]),
    __metadata("design:returntype", void 0)
], PageRouterOutlet.prototype, "activateWith", null);
__decorate([
    profile,
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Page, ComponentRef, Object]),
    __metadata("design:returntype", void 0)
], PageRouterOutlet.prototype, "loadComponentInPage", null);
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.1.0", ngImport: i0, type: PageRouterOutlet, decorators: [{
            type: Directive,
            args: [{
                    selector: 'page-router-outlet',
                    standalone: true,
                }]
        }], ctorParameters: () => [{ type: i1.ChildrenOutletContexts }, { type: i0.ViewContainerRef }, { type: undefined, decorators: [{
                    type: Attribute,
                    args: ['name']
                }] }, { type: undefined, decorators: [{
                    type: Attribute,
                    args: ['actionBarVisibility']
                }] }, { type: undefined, decorators: [{
                    type: Attribute,
                    args: ['isEmptyOutlet']
                }] }, { type: i2.NSLocationStrategy }, { type: i0.ComponentFactoryResolver }, { type: i0.ComponentFactoryResolver }, { type: i0.ChangeDetectorRef }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [PAGE_FACTORY]
                }] }, { type: i3.NSRouteReuseStrategy }, { type: i0.NgZone }, { type: i1.Router }, { type: i0.ElementRef }, { type: i4.ViewUtil }, { type: i0.EnvironmentInjector }], propDecorators: { activateEvents: [{
                type: Output,
                args: ['activate']
            }], deactivateEvents: [{
                type: Output,
                args: ['deactivate']
            }], activateWith: [], loadComponentInPage: [] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZS1yb3V0ZXItb3V0bGV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvYW5ndWxhci9zcmMvbGliL2xlZ2FjeS9yb3V0ZXIvcGFnZS1yb3V0ZXItb3V0bGV0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLGlCQUFpQixFQUFvQix3QkFBd0IsRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBa0IsUUFBUSxFQUFhLFlBQVksRUFBRSxNQUFNLEVBQVEsZ0JBQWdCLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsbUJBQW1CLEVBQXlCLE1BQU0sZUFBZSxDQUFDO0FBQzFTLE9BQU8sRUFBRSxjQUFjLEVBQTBCLHNCQUFzQixFQUFRLGNBQWMsRUFBRSxNQUFNLEVBQXdCLE1BQU0saUJBQWlCLENBQUM7QUFFckosT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQWlCLE9BQU8sRUFBbUIsTUFBTSxvQkFBb0IsQ0FBQztBQUUxRixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRXZDLE9BQU8sRUFBRSxZQUFZLEVBQWUsTUFBTSxjQUFjLENBQUM7QUFDekQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ2hELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDNUQsT0FBTyxFQUFFLGlCQUFpQixFQUFVLE1BQU0scUJBQXFCLENBQUM7QUFDaEUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDakUsT0FBTyxFQUFFLGtDQUFrQyxFQUFFLHlCQUF5QixFQUFFLGVBQWUsRUFBRSxt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QUFRLEVBQUUsb0JBQW9CO29CQUM5QixVQUFVLEVBQUUsSUFBSTtpQkFDakI7OzBCQXFFSSxTQUFTOzJCQUFDLE1BQU07OzBCQUNoQixTQUFTOzJCQUFDLHFCQUFxQjs7MEJBQy9CLFNBQVM7MkJBQUMsZUFBZTs7MEJBS3pCLE1BQU07MkJBQUMsWUFBWTt3TUF2REYsY0FBYztzQkFBakMsTUFBTTt1QkFBQyxVQUFVO2dCQUVJLGdCQUFnQjtzQkFBckMsTUFBTTt1QkFBQyxZQUFZO2dCQW9OcEIsWUFBWSxNQThFSixtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBdHRyaWJ1dGUsIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnRGYWN0b3J5LCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIENvbXBvbmVudFJlZiwgRGlyZWN0aXZlLCBJbmplY3QsIEluamVjdGlvblRva2VuLCBJbmplY3RvciwgT25EZXN0cm95LCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgVHlwZSwgVmlld0NvbnRhaW5lclJlZiwgRWxlbWVudFJlZiwgSW5qZWN0RmxhZ3MsIE5nWm9uZSwgRW52aXJvbm1lbnRJbmplY3RvciwgaW5qZWN0LCBJbmplY3RPcHRpb25zIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSwgQWN0aXZhdGVkUm91dGVTbmFwc2hvdCwgQ2hpbGRyZW5PdXRsZXRDb250ZXh0cywgRGF0YSwgUFJJTUFSWV9PVVRMRVQsIFJvdXRlciwgUm91dGVyT3V0bGV0Q29udHJhY3QgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuXG5pbXBvcnQgeyBGcmFtZSwgUGFnZSwgTmF2aWdhdGVkRGF0YSwgcHJvZmlsZSwgTmF2aWdhdGlvbkVudHJ5IH0gZnJvbSAnQG5hdGl2ZXNjcmlwdC9jb3JlJztcblxuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IFBBR0VfRkFDVE9SWSwgUGFnZUZhY3RvcnkgfSBmcm9tICcuLi8uLi90b2tlbnMnO1xuaW1wb3J0IHsgTmF0aXZlU2NyaXB0RGVidWcgfSBmcm9tICcuLi8uLi90cmFjZSc7XG5pbXBvcnQgeyBEZXRhY2hlZExvYWRlciB9IGZyb20gJy4uLy4uL2Nkay9kZXRhY2hlZC1sb2FkZXInO1xuaW1wb3J0IHsgVmlld1V0aWwgfSBmcm9tICcuLi8uLi92aWV3LXV0aWwnO1xuaW1wb3J0IHsgTlNMb2NhdGlvblN0cmF0ZWd5IH0gZnJvbSAnLi9ucy1sb2NhdGlvbi1zdHJhdGVneSc7XG5pbXBvcnQgeyBkZWZhdWx0TmF2T3B0aW9ucywgT3V0bGV0IH0gZnJvbSAnLi9ucy1sb2NhdGlvbi11dGlscyc7XG5pbXBvcnQgeyBOU1JvdXRlUmV1c2VTdHJhdGVneSB9IGZyb20gJy4vbnMtcm91dGUtcmV1c2Utc3RyYXRlZ3knO1xuaW1wb3J0IHsgZmluZFRvcEFjdGl2YXRlZFJvdXRlTm9kZUZvck91dGxldCwgcGFnZVJvdXRlckFjdGl2YXRlZFN5bWJvbCwgbG9hZGVyUmVmU3ltYm9sLCBkZXN0cm95Q29tcG9uZW50UmVmIH0gZnJvbSAnLi9wYWdlLXJvdXRlci1vdXRsZXQtdXRpbHMnO1xuaW1wb3J0IHsgcmVnaXN0ZXJFbGVtZW50IH0gZnJvbSAnLi4vLi4vZWxlbWVudC1yZWdpc3RyeSc7XG5pbXBvcnQgeyBQYWdlU2VydmljZSB9IGZyb20gJy4uLy4uL2Nkay9mcmFtZS1wYWdlL3BhZ2Uuc2VydmljZSc7XG5pbXBvcnQgeyBFeHRlbmRlZE5hdmlnYXRpb25FeHRyYXMgfSBmcm9tICcuL3JvdXRlci1leHRlbnNpb25zJztcblxuZXhwb3J0IGNsYXNzIFBhZ2VSb3V0ZSB7XG4gIGFjdGl2YXRlZFJvdXRlOiBCZWhhdmlvclN1YmplY3Q8QWN0aXZhdGVkUm91dGU+O1xuXG4gIGNvbnN0cnVjdG9yKHN0YXJ0Um91dGU6IEFjdGl2YXRlZFJvdXRlKSB7XG4gICAgdGhpcy5hY3RpdmF0ZWRSb3V0ZSA9IG5ldyBCZWhhdmlvclN1YmplY3Qoc3RhcnRSb3V0ZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaXNDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIoaXRlbTogYW55KTogaXRlbSBpcyBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIge1xuICByZXR1cm4gISFpdGVtLnJlc29sdmVDb21wb25lbnRGYWN0b3J5O1xufVxuXG5mdW5jdGlvbiBjYWxsYWJsZU9uY2U8VD4oZm46ICguLi5hcmdzOiBUW10pID0+IHZvaWQpIHtcbiAgbGV0IGNhbGxlZCA9IGZhbHNlO1xuICByZXR1cm4gKC4uLmFyZ3M6IFRbXSkgPT4ge1xuICAgIGlmIChjYWxsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY2FsbGVkID0gdHJ1ZTtcbiAgICByZXR1cm4gZm4oLi4uYXJncyk7XG4gIH07XG59XG5cbmV4cG9ydCBjbGFzcyBEZXN0cnVjdGlibGVJbmplY3RvciBpbXBsZW1lbnRzIEluamVjdG9yIHtcbiAgcHJpdmF0ZSByZWZzID0gbmV3IFNldDxhbnk+KCk7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZGVzdHJ1Y3RpYmxlUHJvdmlkZXJzOiBQcm92aWRlclNldCwgcHJpdmF0ZSBwYXJlbnQ6IEluamVjdG9yKSB7fVxuICBnZXQ8VD4odG9rZW46IFR5cGU8VD4gfCBJbmplY3Rpb25Ub2tlbjxUPiwgbm90Rm91bmRWYWx1ZT86IFQsIGZsYWdzPzogSW5qZWN0T3B0aW9ucyB8IEluamVjdEZsYWdzKTogVCB7XG4gICAgY29uc3QgcmVmID0gdGhpcy5wYXJlbnQuZ2V0KHRva2VuLCBub3RGb3VuZFZhbHVlLCBmbGFncyk7XG5cbiAgICAvLyBpZiB3ZSdyZSBza2lwcGluZyBvdXJzZWx2ZXMgdGhlbiBpdCdzIG5vdCBvdXIgcmVzcG9uc2liaWxpdHkgdG8gZGVzdHJveVxuICAgIGlmICh0eXBlb2YgZmxhZ3MgPT09ICdudW1iZXInKSB7XG4gICAgICBpZiAoIShmbGFncyAmIEluamVjdEZsYWdzLlNraXBTZWxmKSAmJiB0aGlzLmRlc3RydWN0aWJsZVByb3ZpZGVycy5oYXModG9rZW4pKSB7XG4gICAgICAgIHRoaXMucmVmcy5hZGQocmVmKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCFmbGFncz8uc2tpcFNlbGYgJiYgdGhpcy5kZXN0cnVjdGlibGVQcm92aWRlcnMuaGFzKHRva2VuKSkge1xuICAgICAgICB0aGlzLnJlZnMuYWRkKHJlZik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlZjtcbiAgfVxuICBkZXN0cm95KCkge1xuICAgIHRoaXMucmVmcy5mb3JFYWNoKChyZWYpID0+IHtcbiAgICAgIGlmIChyZWYubmdPbkRlc3Ryb3kgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xuICAgICAgICByZWYubmdPbkRlc3Ryb3koKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLnJlZnMuY2xlYXIoKTtcbiAgfVxufVxuXG50eXBlIFByb3ZpZGVyU2V0ID0gU2V0PFR5cGU8YW55PiB8IEluamVjdGlvblRva2VuPGFueT4+O1xuXG5jb25zdCByb3V0ZVRvU3RyaW5nID0gZnVuY3Rpb24gKGFjdGl2YXRlZFJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSB8IEFjdGl2YXRlZFJvdXRlU25hcHNob3QpOiBzdHJpbmcge1xuICByZXR1cm4gYWN0aXZhdGVkUm91dGUucGF0aEZyb21Sb290LmpvaW4oJy0+Jyk7XG59O1xuXG5yZWdpc3RlckVsZW1lbnQoJ3BhZ2Utcm91dGVyLW91dGxldCcsICgpID0+IEZyYW1lKTtcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvZGlyZWN0aXZlLXNlbGVjdG9yXG5ARGlyZWN0aXZlKHsgXG4gIHNlbGVjdG9yOiAncGFnZS1yb3V0ZXItb3V0bGV0JyxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbn0pIC8vIHRzbGludDpkaXNhYmxlLWxpbmU6ZGlyZWN0aXZlLXNlbGVjdG9yXG5leHBvcnQgY2xhc3MgUGFnZVJvdXRlck91dGxldCBpbXBsZW1lbnRzIE9uRGVzdHJveSwgUm91dGVyT3V0bGV0Q29udHJhY3Qge1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOmRpcmVjdGl2ZS1jbGFzcy1zdWZmaXhcbiAgcHJpdmF0ZSBhY3RpdmF0ZWQ6IENvbXBvbmVudFJlZjxhbnk+IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgX2FjdGl2YXRlZFJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGRldGFjaGVkTG9hZGVyRmFjdG9yeTogQ29tcG9uZW50RmFjdG9yeTxEZXRhY2hlZExvYWRlcj47XG5cbiAgcHJpdmF0ZSBvdXRsZXQ6IE91dGxldDtcbiAgcHJpdmF0ZSBuYW1lOiBzdHJpbmc7XG4gIHByaXZhdGUgaXNFbXB0eU91dGxldDogYm9vbGVhbjtcbiAgcHJpdmF0ZSB2aWV3VXRpbDogVmlld1V0aWw7XG4gIHByaXZhdGUgZnJhbWU6IEZyYW1lO1xuICAvLyB0aGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gY2xlYXIgdGhlIG91dGxldCBjYWNoZSAoY2xlYXIgaGlzdG9yeSlcbiAgLy8gdXN1YWxseSBpdCdzIGNsZWFyZWQgaW4gYG5hdmlnYXRlZFRvYCwgYnV0IG9uIHF1aWNrIG5hdmlnYXRpb24sIHRoZSBldmVudCB3aWxsIGJlIGZpcmVkIGFmdGVyIGFuZ3VsYXIgYWxyZWFkeSBhZGRlZCBtb3JlIHRoaW5ncyB0byB0aGUgY2FjaGVcbiAgLy8gc28gbm93IHdlIGNhbGwgdGhpcyBpZiB0aGUgY29tcG9uZW50IGlzIGRldGFjaGVkIG9yIGRlYWN0aXZhdGVkIChtZWFuaW5nIGl0J3MgbWlkLW5hdmlnYXRpb24sIGJlZm9yZSBjYWNoZSBtYW5pcHVsYXRpb24pXG4gIHByaXZhdGUgcG9zdE5hdkZ1bmN0aW9uOiAoKSA9PiB2b2lkO1xuXG4gIGF0dGFjaEV2ZW50czogRXZlbnRFbWl0dGVyPHVua25vd24+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBkZXRhY2hFdmVudHM6IEV2ZW50RW1pdHRlcjx1bmtub3duPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L25vLW91dHB1dC1yZW5hbWVcbiAgQE91dHB1dCgnYWN0aXZhdGUnKSBhY3RpdmF0ZUV2ZW50cyA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpOyAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOm5vLW91dHB1dC1yZW5hbWVcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtcmVuYW1lXG4gIEBPdXRwdXQoJ2RlYWN0aXZhdGUnKSBkZWFjdGl2YXRlRXZlbnRzID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7IC8vIHRzbGludDpkaXNhYmxlLWxpbmU6bm8tb3V0cHV0LXJlbmFtZVxuXG4gIC8qKiBAZGVwcmVjYXRlZCBmcm9tIEFuZ3VsYXIgc2luY2UgdjQgKi9cbiAgZ2V0IGxvY2F0aW9uSW5qZWN0b3IoKTogSW5qZWN0b3Ige1xuICAgIHJldHVybiB0aGlzLmxvY2F0aW9uLmluamVjdG9yO1xuICB9XG4gIC8qKiBAZGVwcmVjYXRlZCBmcm9tIEFuZ3VsYXIgc2luY2UgdjQgKi9cbiAgZ2V0IGxvY2F0aW9uRmFjdG9yeVJlc29sdmVyKCk6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciB7XG4gICAgcmV0dXJuIHRoaXMucmVzb2x2ZXI7XG4gIH1cblxuICBnZXQgaXNBY3RpdmF0ZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICEhdGhpcy5hY3RpdmF0ZWQ7XG4gIH1cblxuICBnZXQgY29tcG9uZW50KCk6IHVua25vd24ge1xuICAgIGlmICghdGhpcy5hY3RpdmF0ZWQpIHtcbiAgICAgIGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuICAgICAgICBOYXRpdmVTY3JpcHREZWJ1Zy5yb3V0ZXJMb2coJ091dGxldCBpcyBub3QgYWN0aXZhdGVkJyk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuYWN0aXZhdGVkLmluc3RhbmNlO1xuICB9XG4gIGdldCBhY3RpdmF0ZWRSb3V0ZSgpOiBBY3RpdmF0ZWRSb3V0ZSB7XG4gICAgaWYgKCF0aGlzLmFjdGl2YXRlZCkge1xuICAgICAgaWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG4gICAgICAgIE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZygnT3V0bGV0IGlzIG5vdCBhY3RpdmF0ZWQnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5fYWN0aXZhdGVkUm91dGU7XG4gIH1cblxuICBnZXQgYWN0aXZhdGVkUm91dGVEYXRhKCk6IERhdGEge1xuICAgIGlmICh0aGlzLl9hY3RpdmF0ZWRSb3V0ZSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2YXRlZFJvdXRlLnNuYXBzaG90LmRhdGE7XG4gICAgfVxuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcGFyZW50Q29udGV4dHM6IENoaWxkcmVuT3V0bGV0Q29udGV4dHMsXG4gICAgcHJpdmF0ZSBsb2NhdGlvbjogVmlld0NvbnRhaW5lclJlZixcbiAgICBAQXR0cmlidXRlKCduYW1lJykgbmFtZTogc3RyaW5nLFxuICAgIEBBdHRyaWJ1dGUoJ2FjdGlvbkJhclZpc2liaWxpdHknKSBhY3Rpb25CYXJWaXNpYmlsaXR5OiBzdHJpbmcsXG4gICAgQEF0dHJpYnV0ZSgnaXNFbXB0eU91dGxldCcpIGlzRW1wdHlPdXRsZXQ6IGJvb2xlYW4sXG4gICAgcHJpdmF0ZSBsb2NhdGlvblN0cmF0ZWd5OiBOU0xvY2F0aW9uU3RyYXRlZ3ksXG4gICAgcHJpdmF0ZSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICBwcml2YXRlIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgcHJpdmF0ZSBjaGFuZ2VEZXRlY3RvcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgQEluamVjdChQQUdFX0ZBQ1RPUlkpIHByaXZhdGUgcGFnZUZhY3Rvcnk6IFBhZ2VGYWN0b3J5LFxuICAgIHByaXZhdGUgcm91dGVSZXVzZVN0cmF0ZWd5OiBOU1JvdXRlUmV1c2VTdHJhdGVneSxcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgZWxSZWY6IEVsZW1lbnRSZWYsXG4gICAgdmlld1V0aWw6IFZpZXdVdGlsLFxuICAgIHByaXZhdGUgZW52aXJvbm1lbnRJbmplY3RvcjogRW52aXJvbm1lbnRJbmplY3RvclxuICApIHtcbiAgICB0aGlzLmlzRW1wdHlPdXRsZXQgPSBpc0VtcHR5T3V0bGV0O1xuICAgIHRoaXMuZnJhbWUgPSBlbFJlZi5uYXRpdmVFbGVtZW50O1xuICAgIHRoaXMuc2V0QWN0aW9uQmFyVmlzaWJpbGl0eShhY3Rpb25CYXJWaXNpYmlsaXR5KTtcbiAgICBpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcbiAgICAgIE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZyhgUGFnZVJvdXRlck91dGxldC5jb25zdHJ1Y3RvciBmcmFtZTogJHt0aGlzLmZyYW1lfWApO1xuICAgIH1cblxuICAgIHRoaXMubmFtZSA9IG5hbWUgfHwgUFJJTUFSWV9PVVRMRVQ7XG4gICAgcGFyZW50Q29udGV4dHMub25DaGlsZE91dGxldENyZWF0ZWQodGhpcy5uYW1lLCA8YW55PnRoaXMpO1xuXG4gICAgdGhpcy52aWV3VXRpbCA9IHZpZXdVdGlsO1xuICAgIHRoaXMuZGV0YWNoZWRMb2FkZXJGYWN0b3J5ID0gcmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoRGV0YWNoZWRMb2FkZXIpO1xuICB9XG5cbiAgc2V0QWN0aW9uQmFyVmlzaWJpbGl0eShhY3Rpb25CYXJWaXNpYmlsaXR5OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBzd2l0Y2ggKGFjdGlvbkJhclZpc2liaWxpdHkpIHtcbiAgICAgIGNhc2UgJ2Fsd2F5cyc6XG4gICAgICBjYXNlICduZXZlcic6XG4gICAgICAgIHRoaXMuZnJhbWUuYWN0aW9uQmFyVmlzaWJpbGl0eSA9IGFjdGlvbkJhclZpc2liaWxpdHk7XG4gICAgICAgIHJldHVybjtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhpcy5mcmFtZS5hY3Rpb25CYXJWaXNpYmlsaXR5ID0gJ2F1dG8nO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIC8vIEluIHRoZSBldmVudCB0aGF0IHRoZSBgcGFyZW50Q29udGV4dHNgIGhhcyBjaGFuZ2VkIHRoZSBvdXRsZXRcbiAgICAvLyB2aWEgdGhlIGNyZWF0aW9uIG9mIGFub3RoZXIgb3V0bGV0LCB0aGUgYG9uQ2hpbGRPdXRsZXREZXN0cm95ZWRgXG4gICAgLy8gd2lsbCBiZSBza2lwcGVkXG4gICAgaWYgKHRoaXMucGFyZW50Q29udGV4dHMuZ2V0Q29udGV4dCh0aGlzLm5hbWUpPy5vdXRsZXQgPT09IDxhbnk+dGhpcykge1xuICAgICAgLy8gQ2xlYXIgYWNjdW11bGF0ZWQgbW9kYWwgdmlldyBwYWdlIGNhY2hlIHdoZW4gcGFnZS1yb3V0ZXItb3V0bGV0XG4gICAgICAvLyBkZXN0cm95ZWQgb24gbW9kYWwgdmlldyBjbG9zaW5nXG4gICAgICB0aGlzLnBhcmVudENvbnRleHRzLm9uQ2hpbGRPdXRsZXREZXN0cm95ZWQodGhpcy5uYW1lKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5vdXRsZXQpIHtcbiAgICAgIHRoaXMub3V0bGV0Lm91dGxldEtleXMuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgIHRoaXMucm91dGVSZXVzZVN0cmF0ZWd5LmNsZWFyTW9kYWxDYWNoZShrZXkpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmxvY2F0aW9uU3RyYXRlZ3kuY2xlYXJPdXRsZXQodGhpcy5mcmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZygnUGFnZVJvdXRlck91dGxldC5uZ09uRGVzdHJveTogbm8gb3V0bGV0IGF2YWlsYWJsZSBmb3IgcGFnZS1yb3V0ZXItb3V0bGV0Jyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNBY3RpdmF0ZWQpIHtcbiAgICAgIGNvbnN0IGMgPSB0aGlzLmFjdGl2YXRlZC5pbnN0YW5jZTtcbiAgICAgIHRoaXMuYWN0aXZhdGVkLmhvc3RWaWV3LmRldGFjaCgpO1xuICAgICAgZGVzdHJveUNvbXBvbmVudFJlZih0aGlzLmFjdGl2YXRlZCk7XG5cbiAgICAgIHRoaXMuZGVhY3RpdmF0ZUV2ZW50cy5lbWl0KGMpO1xuICAgICAgdGhpcy5hY3RpdmF0ZWQgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGRlYWN0aXZhdGUoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLm91dGxldCB8fCAhdGhpcy5vdXRsZXQuaXNQYWdlTmF2aWdhdGlvbkJhY2spIHtcbiAgICAgIGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuICAgICAgICBOYXRpdmVTY3JpcHREZWJ1Zy5yb3V0ZXJMb2coJ0N1cnJlbnRseSBub3QgaW4gcGFnZSBiYWNrIG5hdmlnYXRpb24gLSBjb21wb25lbnQgc2hvdWxkIGJlIGRldGFjaGVkIGluc3RlYWQgb2YgZGVhY3RpdmF0ZWQuJyk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG4gICAgICBOYXRpdmVTY3JpcHREZWJ1Zy5yb3V0ZXJMb2coJ1BhZ2VSb3V0ZXJPdXRsZXQuZGVhY3RpdmF0ZSgpIHdoaWxlIGdvaW5nIGJhY2sgLSBzaG91bGQgZGVzdHJveScpO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5pc0FjdGl2YXRlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnBvc3ROYXZGdW5jdGlvbj8uKCk7XG5cbiAgICBjb25zdCBjID0gdGhpcy5hY3RpdmF0ZWQuaW5zdGFuY2U7XG4gICAgZGVzdHJveUNvbXBvbmVudFJlZih0aGlzLmFjdGl2YXRlZCk7XG5cbiAgICB0aGlzLmFjdGl2YXRlZCA9IG51bGw7XG4gICAgdGhpcy5fYWN0aXZhdGVkUm91dGUgPSBudWxsO1xuXG4gICAgdGhpcy5kZWFjdGl2YXRlRXZlbnRzLmVtaXQoYyk7XG4gIH1cblxuICAvKipcbiAgICogQ2FsbGVkIHdoZW4gdGhlIGBSb3V0ZVJldXNlU3RyYXRlZ3lgIGluc3RydWN0cyB0byBkZXRhY2ggdGhlIHN1YnRyZWVcbiAgICovXG4gIGRldGFjaCgpOiBDb21wb25lbnRSZWY8YW55PiB7XG4gICAgaWYgKCF0aGlzLmlzQWN0aXZhdGVkKSB7XG4gICAgICBpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcbiAgICAgICAgTmF0aXZlU2NyaXB0RGVidWcucm91dGVyTG9nKCdPdXRsZXQgaXMgbm90IGFjdGl2YXRlZCcpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuICAgICAgTmF0aXZlU2NyaXB0RGVidWcucm91dGVyTG9nKGBQYWdlUm91dGVyT3V0bGV0LmRldGFjaCgpIC0gJHtyb3V0ZVRvU3RyaW5nKHRoaXMuX2FjdGl2YXRlZFJvdXRlKX1gKTtcbiAgICB9XG5cbiAgICB0aGlzLnBvc3ROYXZGdW5jdGlvbj8uKCk7XG5cbiAgICAvLyBEZXRhY2ggZnJvbSBDaGFuZ2VEZXRlY3Rpb25cbiAgICB0aGlzLmFjdGl2YXRlZC5ob3N0Vmlldy5kZXRhY2goKTtcblxuICAgIGNvbnN0IGNvbXBvbmVudCA9IHRoaXMuYWN0aXZhdGVkO1xuICAgIHRoaXMuYWN0aXZhdGVkID0gbnVsbDtcbiAgICB0aGlzLl9hY3RpdmF0ZWRSb3V0ZSA9IG51bGw7XG4gICAgdGhpcy5kZXRhY2hFdmVudHMuZW1pdChjb21wb25lbnQuaW5zdGFuY2UpO1xuICAgIHJldHVybiBjb21wb25lbnQ7XG4gIH1cblxuICAvKipcbiAgICogQ2FsbGVkIHdoZW4gdGhlIGBSb3V0ZVJldXNlU3RyYXRlZ3lgIGluc3RydWN0cyB0byByZS1hdHRhY2ggYSBwcmV2aW91c2x5IGRldGFjaGVkIHN1YnRyZWVcbiAgICovXG4gIGF0dGFjaChyZWY6IENvbXBvbmVudFJlZjxhbnk+LCBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUpIHtcbiAgICBpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcbiAgICAgIE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZyhgUGFnZVJvdXRlck91dGxldC5hdHRhY2goKSAtICR7cm91dGVUb1N0cmluZyhhY3RpdmF0ZWRSb3V0ZSl9YCk7XG4gICAgfVxuXG4gICAgdGhpcy5hY3RpdmF0ZWQgPSByZWY7XG5cbiAgICAvLyByZWF0dGFjaCB0byBDaGFuZ2VEZXRlY3Rpb25cbiAgICB0aGlzLmFjdGl2YXRlZC5ob3N0Vmlldy5tYXJrRm9yQ2hlY2soKTtcbiAgICB0aGlzLmFjdGl2YXRlZC5ob3N0Vmlldy5yZWF0dGFjaCgpO1xuICAgIHRoaXMuX2FjdGl2YXRlZFJvdXRlID0gYWN0aXZhdGVkUm91dGU7XG4gICAgdGhpcy5tYXJrQWN0aXZhdGVkUm91dGUoYWN0aXZhdGVkUm91dGUpO1xuXG4gICAgLy8gd2UgaGF2ZSBhIGNoaWxkIHdpdGggdGhlIHNhbWUgbmFtZSwgc28gd2UgZG9uJ3QgZmluaXNoIHRoZSBiYWNrIG5hdlxuICAgIGlmICh0aGlzLmlzRmluYWxQYWdlUm91dGVyT3V0bGV0KCkpIHtcbiAgICAgIHRoaXMubG9jYXRpb25TdHJhdGVneS5fZmluaXNoQmFja1BhZ2VOYXZpZ2F0aW9uKHRoaXMuZnJhbWUpO1xuICAgIH1cbiAgICB0aGlzLmF0dGFjaEV2ZW50cy5lbWl0KHJlZi5pbnN0YW5jZSk7XG4gIH1cblxuICBwcml2YXRlIGlzRmluYWxQYWdlUm91dGVyT3V0bGV0KCkge1xuICAgIGxldCBjaGlsZHJlbiA9IHRoaXMucGFyZW50Q29udGV4dHMuZ2V0Q29udGV4dCh0aGlzLm5hbWUpPy5jaGlsZHJlbjtcbiAgICB3aGlsZSAoY2hpbGRyZW4pIHtcbiAgICAgIGNvbnN0IGNoaWxkQ29udGV4dCA9IGNoaWxkcmVuLmdldENvbnRleHQodGhpcy5uYW1lKTtcbiAgICAgIGlmICghY2hpbGRDb250ZXh0IHx8ICFjaGlsZENvbnRleHQub3V0bGV0KSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKGNoaWxkQ29udGV4dC5vdXRsZXQgaW5zdGFuY2VvZiBQYWdlUm91dGVyT3V0bGV0KSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGNoaWxkcmVuID0gY2hpbGRDb250ZXh0LmNoaWxkcmVuO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxsZWQgYnkgdGhlIFJvdXRlciB0byBpbnN0YW50aWF0ZSBhIG5ldyBjb21wb25lbnQgZHVyaW5nIHRoZSBjb21taXQgcGhhc2Ugb2YgYSBuYXZpZ2F0aW9uLlxuICAgKiBUaGlzIG1ldGhvZCBpbiB0dXJuIGlzIHJlc3BvbnNpYmxlIGZvciBjYWxsaW5nIHRoZSBgcm91dGVyT25BY3RpdmF0ZWAgaG9vayBvZiBpdHMgY2hpbGQuXG4gICAqL1xuICBAcHJvZmlsZVxuICBhY3RpdmF0ZVdpdGgoYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlLCByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyIHwgRW52aXJvbm1lbnRJbmplY3RvciB8IG51bGwpOiB2b2lkIHtcbiAgICB0aGlzLm91dGxldCA9IHRoaXMub3V0bGV0IHx8IHRoaXMuZ2V0T3V0bGV0KGFjdGl2YXRlZFJvdXRlLnNuYXBzaG90KTtcbiAgICBpZiAoIXRoaXMub3V0bGV0KSB7XG4gICAgICBpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcbiAgICAgICAgTmF0aXZlU2NyaXB0RGVidWcucm91dGVyRXJyb3IoJ05vIG91dGxldCBmb3VuZCByZWxhdGl2ZSB0byBhY3RpdmF0ZWQgcm91dGUnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLm91dGxldC5pc05TRW1wdHlPdXRsZXQgPSB0aGlzLmlzRW1wdHlPdXRsZXQ7XG4gICAgdGhpcy5sb2NhdGlvblN0cmF0ZWd5LnVwZGF0ZU91dGxldEZyYW1lKHRoaXMub3V0bGV0LCB0aGlzLmZyYW1lLCB0aGlzLmlzRW1wdHlPdXRsZXQpO1xuXG4gICAgaWYgKHRoaXMub3V0bGV0ICYmIHRoaXMub3V0bGV0LmlzUGFnZU5hdmlnYXRpb25CYWNrKSB7XG4gICAgICBpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcbiAgICAgICAgTmF0aXZlU2NyaXB0RGVidWcucm91dGVyTG9nKCdDdXJyZW50bHkgaW4gcGFnZSBiYWNrIG5hdmlnYXRpb24gLSBjb21wb25lbnQgc2hvdWxkIGJlIHJlYXR0YWNoZWQgaW5zdGVhZCBvZiBhY3RpdmF0ZWQuJyk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5pc0ZpbmFsUGFnZVJvdXRlck91dGxldCgpKSB7XG4gICAgICAgIHRoaXMubG9jYXRpb25TdHJhdGVneS5fZmluaXNoQmFja1BhZ2VOYXZpZ2F0aW9uKHRoaXMuZnJhbWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuICAgICAgTmF0aXZlU2NyaXB0RGVidWcucm91dGVyTG9nKGBQYWdlUm91dGVyT3V0bGV0LmFjdGl2YXRlV2l0aCgpIC0gJHtyb3V0ZVRvU3RyaW5nKGFjdGl2YXRlZFJvdXRlKX1gKTtcbiAgICB9XG5cbiAgICB0aGlzLl9hY3RpdmF0ZWRSb3V0ZSA9IGFjdGl2YXRlZFJvdXRlO1xuXG4gICAgdGhpcy5tYXJrQWN0aXZhdGVkUm91dGUoYWN0aXZhdGVkUm91dGUpO1xuXG4gICAgdGhpcy5hY3RpdmF0ZU9uR29Gb3J3YXJkKGFjdGl2YXRlZFJvdXRlLCByZXNvbHZlciB8fCB0aGlzLmVudmlyb25tZW50SW5qZWN0b3IpO1xuICAgIHRoaXMuYWN0aXZhdGVFdmVudHMuZW1pdCh0aGlzLmFjdGl2YXRlZC5pbnN0YW5jZSk7XG4gIH1cblxuICBwcml2YXRlIGFjdGl2YXRlT25Hb0ZvcndhcmQoYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlLCByZXNvbHZlck9ySW5qZWN0b3I6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciB8IEVudmlyb25tZW50SW5qZWN0b3IpOiB2b2lkIHtcbiAgICBpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcbiAgICAgIE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZygnUGFnZVJvdXRlck91dGxldC5hY3RpdmF0ZSgpIGZvcndhcmQgbmF2aWdhdGlvbiAtICcgKyAnY3JlYXRlIGRldGFjaGVkIGxvYWRlciBpbiB0aGUgbG9hZGVyIGNvbnRhaW5lcicpO1xuICAgIH1cblxuICAgIGNvbnN0IGNvbXBvbmVudCA9IHRoaXMuZ2V0Q29tcG9uZW50VHlwZShhY3RpdmF0ZWRSb3V0ZSk7XG4gICAgY29uc3QgcGFnZSA9IHRoaXMucGFnZUZhY3Rvcnkoe1xuICAgICAgaXNOYXZpZ2F0aW9uOiB0cnVlLFxuICAgICAgY29tcG9uZW50VHlwZTogY29tcG9uZW50LFxuICAgIH0pO1xuICAgIGNvbnN0IGxvY2F0aW9uID0gdGhpcy5sb2NhdGlvbjtcblxuICAgIGNvbnN0IGRlc3RydWN0aWJsZXMgPSBuZXcgU2V0KFtQYWdlU2VydmljZV0pO1xuICAgIGNvbnN0IHBhcmVudEluamVjdG9yID0gSW5qZWN0b3IuY3JlYXRlKHtcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7IHByb3ZpZGU6IFBhZ2UsIHVzZVZhbHVlOiBwYWdlIH0sXG4gICAgICAgIHsgcHJvdmlkZTogRnJhbWUsIHVzZVZhbHVlOiB0aGlzLmZyYW1lIH0sXG4gICAgICAgIHsgcHJvdmlkZTogUGFnZVJvdXRlLCB1c2VWYWx1ZTogbmV3IFBhZ2VSb3V0ZShhY3RpdmF0ZWRSb3V0ZSkgfSxcbiAgICAgICAgeyBwcm92aWRlOiBBY3RpdmF0ZWRSb3V0ZSwgdXNlVmFsdWU6IGFjdGl2YXRlZFJvdXRlIH0sXG4gICAgICAgIHsgcHJvdmlkZTogQ2hpbGRyZW5PdXRsZXRDb250ZXh0cywgdXNlVmFsdWU6IHRoaXMucGFyZW50Q29udGV4dHMuZ2V0T3JDcmVhdGVDb250ZXh0KHRoaXMubmFtZSkuY2hpbGRyZW4gfSxcbiAgICAgICAgeyBwcm92aWRlOiBQYWdlU2VydmljZSwgdXNlQ2xhc3M6IFBhZ2VTZXJ2aWNlIH0sXG4gICAgICBdLFxuICAgICAgcGFyZW50OiBsb2NhdGlvbi5pbmplY3RvcixcbiAgICB9KTtcblxuICAgIGNvbnN0IGluamVjdG9yID0gbmV3IERlc3RydWN0aWJsZUluamVjdG9yKGRlc3RydWN0aWJsZXMsIHBhcmVudEluamVjdG9yKTtcbiAgICBsZXQgbG9hZGVyUmVmOiBDb21wb25lbnRSZWY8RGV0YWNoZWRMb2FkZXI+O1xuICAgIGlmIChpc0NvbXBvbmVudEZhY3RvcnlSZXNvbHZlcihyZXNvbHZlck9ySW5qZWN0b3IpKSB7XG4gICAgICBjb25zdCBmYWN0b3J5ID0gcmVzb2x2ZXJPckluamVjdG9yLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KERldGFjaGVkTG9hZGVyKTtcbiAgICAgIGxvYWRlclJlZiA9IGxvY2F0aW9uLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5LCBsb2NhdGlvbi5sZW5ndGgsIGluamVjdG9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgZW52aXJvbm1lbnRJbmplY3RvciA9IHJlc29sdmVyT3JJbmplY3RvcjtcbiAgICAgIGxvYWRlclJlZiA9IGxvY2F0aW9uLmNyZWF0ZUNvbXBvbmVudChEZXRhY2hlZExvYWRlciwgeyBpbmRleDogbG9jYXRpb24ubGVuZ3RoLCBpbmplY3RvciwgZW52aXJvbm1lbnRJbmplY3RvciB9KTtcbiAgICB9XG4gICAgbG9hZGVyUmVmLm9uRGVzdHJveSgoKSA9PiBpbmplY3Rvci5kZXN0cm95KCkpO1xuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IubWFya0ZvckNoZWNrKCk7XG5cbiAgICB0aGlzLmFjdGl2YXRlZCA9IGxvYWRlclJlZi5pbnN0YW5jZS5sb2FkQ29tcG9uZW50SW5Mb2NhdGlvbihjb21wb25lbnQpO1xuICAgIHRoaXMuYWN0aXZhdGVkLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICB0aGlzLmxvYWRDb21wb25lbnRJblBhZ2UocGFnZSwgdGhpcy5hY3RpdmF0ZWQsIHsgYWN0aXZhdGVkUm91dGUgfSk7XG5cbiAgICB0aGlzLmFjdGl2YXRlZFtsb2FkZXJSZWZTeW1ib2xdID0gbG9hZGVyUmVmO1xuICB9XG5cbiAgQHByb2ZpbGVcbiAgcHJpdmF0ZSBsb2FkQ29tcG9uZW50SW5QYWdlKHBhZ2U6IFBhZ2UsIGNvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPGFueT4sIG5hdmlnYXRpb25Db250ZXh0KTogdm9pZCB7XG4gICAgLy8gQ29tcG9uZW50IGxvYWRlZC4gRmluZCBpdHMgcm9vdCBuYXRpdmUgdmlldy5cbiAgICBjb25zdCBjb21wb25lbnRWaWV3ID0gY29tcG9uZW50UmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQ7XG4gICAgLy8gUmVtb3ZlIGl0IGZyb20gb3JpZ2luYWwgbmF0aXZlIHBhcmVudC5cbiAgICB0aGlzLnZpZXdVdGlsLnJlbW92ZUNoaWxkKGNvbXBvbmVudFZpZXcucGFyZW50LCBjb21wb25lbnRWaWV3KTtcbiAgICAvLyBBZGQgaXQgdG8gdGhlIG5ldyBwYWdlXG4gICAgdGhpcy52aWV3VXRpbC5hcHBlbmRDaGlsZChwYWdlLCBjb21wb25lbnRWaWV3KTtcblxuICAgIGxldCB0b3BBY3RpdmF0ZWRSb3V0ZSA9IGZpbmRUb3BBY3RpdmF0ZWRSb3V0ZU5vZGVGb3JPdXRsZXQodGhpcy5fYWN0aXZhdGVkUm91dGUuc25hcHNob3QpO1xuICAgIGxldCBvdXRsZXRLZXkgPSB0aGlzLmxvY2F0aW9uU3RyYXRlZ3kuZ2V0Um91dGVGdWxsUGF0aCh0b3BBY3RpdmF0ZWRSb3V0ZSk7XG4gICAgY29uc3QgdGhpc1JvdXRlS2V5ID0gb3V0bGV0S2V5O1xuICAgIHdoaWxlICghdGhpcy5sb2NhdGlvblN0cmF0ZWd5LmZpbmRPdXRsZXQob3V0bGV0S2V5KSkge1xuICAgICAgdG9wQWN0aXZhdGVkUm91dGUgPSB0b3BBY3RpdmF0ZWRSb3V0ZS5wYXJlbnQ7XG4gICAgICBpZiAoIXRvcEFjdGl2YXRlZFJvdXRlKSB7XG4gICAgICAgIE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckVycm9yKCdDb3VsZCBub3QgZmluZCBvdXRsZXQgZm9yIHJvdXRlOiAnICsgdGhpc1JvdXRlS2V5KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBvdXRsZXRLZXkgPSB0aGlzLmxvY2F0aW9uU3RyYXRlZ3kuZ2V0Um91dGVGdWxsUGF0aCh0b3BBY3RpdmF0ZWRSb3V0ZSk7XG4gICAgfVxuXG4gICAgY29uc3QgbmF2aWdhdGVkRnJvbUNhbGxiYWNrID0gKDxhbnk+Z2xvYmFsKS5ab25lLmN1cnJlbnQud3JhcCgoYXJnczogTmF2aWdhdGVkRGF0YSkgPT4ge1xuICAgICAgaWYgKGFyZ3MuaXNCYWNrTmF2aWdhdGlvbikge1xuICAgICAgICB0aGlzLmxvY2F0aW9uU3RyYXRlZ3kuX2JlZ2luQmFja1BhZ2VOYXZpZ2F0aW9uKHRoaXMuZnJhbWUsIG91dGxldEtleSk7XG4gICAgICAgIHRoaXMubG9jYXRpb25TdHJhdGVneS5iYWNrKG51bGwsIHRoaXMuZnJhbWUpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIC8vIFRPRE86IGV4cGVyaW1lbnQgd2l0aCB1c2luZyBOZ1pvbmUgaW5zdGVhZCBvZiBnbG9iYWwgYWJvdmVcbiAgICAvLyBjb25zdCBuYXZpZ2F0ZWRGcm9tQ2FsbGJhY2sgPSAoYXJnczogTmF2aWdhdGVkRGF0YSkgPT4ge1xuICAgIC8vIFx0aWYgKGFyZ3MuaXNCYWNrTmF2aWdhdGlvbikge1xuICAgIC8vICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgIC8vICAgICAgIHRoaXMubG9jYXRpb25TdHJhdGVneS5fYmVnaW5CYWNrUGFnZU5hdmlnYXRpb24odGhpcy5mcmFtZSk7XG4gICAgLy8gICAgICAgdGhpcy5sb2NhdGlvblN0cmF0ZWd5LmJhY2sobnVsbCwgdGhpcy5mcmFtZSk7XG4gICAgLy8gICAgIH0pO1xuICAgIC8vIFx0fVxuICAgIC8vIH07XG5cbiAgICBwYWdlLm9uKFBhZ2UubmF2aWdhdGVkRnJvbUV2ZW50LCBuYXZpZ2F0ZWRGcm9tQ2FsbGJhY2spO1xuICAgIGNvbXBvbmVudFJlZi5vbkRlc3Ryb3koKCkgPT4ge1xuICAgICAgaWYgKHBhZ2UpIHtcbiAgICAgICAgcGFnZS5vZmYoUGFnZS5uYXZpZ2F0ZWRGcm9tRXZlbnQsIG5hdmlnYXRlZEZyb21DYWxsYmFjayk7XG4gICAgICAgIHBhZ2UgPSBudWxsO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29uc3QgbmF2T3B0aW9ucyA9IHsgLi4uZGVmYXVsdE5hdk9wdGlvbnMsIC4uLih0aGlzLnJvdXRlci5nZXRDdXJyZW50TmF2aWdhdGlvbigpLmV4dHJhcyB8fCB7fSkgfSBhcyBFeHRlbmRlZE5hdmlnYXRpb25FeHRyYXM7XG4gICAgdGhpcy5sb2NhdGlvblN0cmF0ZWd5Ll9iZWdpblBhZ2VOYXZpZ2F0aW9uKHRoaXMuZnJhbWUsIG5hdk9wdGlvbnMpO1xuICAgIGNvbnN0IGlzUmVwbGFjZSA9IG5hdk9wdGlvbnMucmVwbGFjZVVybCAmJiAhbmF2T3B0aW9ucy5jbGVhckhpc3Rvcnk7XG5cbiAgICBjb25zdCBjdXJyZW50Um91dGUgPSB0aGlzLmFjdGl2YXRlZFJvdXRlO1xuICAgIC8vIENsZWFyIHJlZkNhY2hlIGlmIG5hdmlnYXRpb24gd2l0aCBjbGVhckhpc3RvcnlcbiAgICBpZiAobmF2T3B0aW9ucy5jbGVhckhpc3RvcnkpIHtcbiAgICAgIHRoaXMub3V0bGV0Lm91dGxldEtleXMuZm9yRWFjaCgoa2V5KSA9PiB0aGlzLnJvdXRlUmV1c2VTdHJhdGVneS5tYXJrQ2FjaGVGb3JDbGVhcihrZXkpKTtcbiAgICAgIGNvbnN0IHdpcGVDYWNoZSA9IGNhbGxhYmxlT25jZSgoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnBvc3ROYXZGdW5jdGlvbiA9PT0gd2lwZUNhY2hlKSB7XG4gICAgICAgICAgdGhpcy5wb3N0TmF2RnVuY3Rpb24gPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm91dGxldCAmJiB0aGlzLmFjdGl2YXRlZFJvdXRlID09PSBjdXJyZW50Um91dGUpIHtcbiAgICAgICAgICAvLyBwb3RlbnRpYWwgYWx0ZXJuYXRpdmUgZml4IChvbmx5IGZpeCBjaGlsZHJlbiBvZiB0aGUgY3VycmVudCBvdXRsZXQpXG4gICAgICAgICAgLy8gY29uc3QgbmVzdHMgPSBvdXRsZXRLZXkuc3BsaXQoJy8nKTtcbiAgICAgICAgICAvLyB0aGlzLm91dGxldC5vdXRsZXRLZXlzLmZpbHRlcigoaykgPT4gay5zcGxpdCgnLycpLmxlbmd0aCA+PSBuZXN0cy5sZW5ndGgpLmZvckVhY2goKGtleSkgPT4gdGhpcy5yb3V0ZVJldXNlU3RyYXRlZ3kuY2xlYXJDYWNoZShrZXkpKTtcbiAgICAgICAgICB0aGlzLm91dGxldC5vdXRsZXRLZXlzLmZvckVhY2goKGtleSkgPT4gdGhpcy5yb3V0ZVJldXNlU3RyYXRlZ3kuY2xlYXJNYXJrZWRDYWNoZShrZXkpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLnBvc3ROYXZGdW5jdGlvbiA9IHdpcGVDYWNoZTtcbiAgICAgIGNvbnN0IGNsZWFyQ2FsbGJhY2sgPSAoKSA9PlxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB3aXBlQ2FjaGUoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIHBhZ2Uub25jZShQYWdlLm5hdmlnYXRlZFRvRXZlbnQsIGNsZWFyQ2FsbGJhY2spO1xuICAgIH0gZWxzZSBpZiAobmF2T3B0aW9ucy5yZXBsYWNlVXJsKSB7XG4gICAgICB0aGlzLm91dGxldC5vdXRsZXRLZXlzLmZvckVhY2goKGtleSkgPT4gdGhpcy5yb3V0ZVJldXNlU3RyYXRlZ3kubWFya0NhY2hlRm9yUG9wKGtleSkpO1xuICAgICAgY29uc3QgcG9wQ2FjaGUgPSBjYWxsYWJsZU9uY2UoKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5wb3N0TmF2RnVuY3Rpb24gPT09IHBvcENhY2hlKSB7XG4gICAgICAgICAgdGhpcy5wb3N0TmF2RnVuY3Rpb24gPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm91dGxldCAmJiB0aGlzLmFjdGl2YXRlZFJvdXRlID09PSBjdXJyZW50Um91dGUpIHtcbiAgICAgICAgICAvLyBwb3RlbnRpYWwgYWx0ZXJuYXRpdmUgZml4IChvbmx5IGZpeCBjaGlsZHJlbiBvZiB0aGUgY3VycmVudCBvdXRsZXQpXG4gICAgICAgICAgLy8gY29uc3QgbmVzdHMgPSBvdXRsZXRLZXkuc3BsaXQoJy8nKTtcbiAgICAgICAgICAvLyB0aGlzLm91dGxldC5vdXRsZXRLZXlzLmZpbHRlcigoaykgPT4gay5zcGxpdCgnLycpLmxlbmd0aCA+PSBuZXN0cy5sZW5ndGgpLmZvckVhY2goKGtleSkgPT4gdGhpcy5yb3V0ZVJldXNlU3RyYXRlZ3kucG9wQ2FjaGUoa2V5KSk7XG4gICAgICAgICAgdGhpcy5vdXRsZXQub3V0bGV0S2V5cy5mb3JFYWNoKChrZXkpID0+IHRoaXMucm91dGVSZXVzZVN0cmF0ZWd5LmNsZWFyTWFya2VkQ2FjaGUoa2V5KSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5wb3N0TmF2RnVuY3Rpb24gPSBwb3BDYWNoZTtcbiAgICAgIGNvbnN0IGNsZWFyQ2FsbGJhY2sgPSAoKSA9PlxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICBwb3BDYWNoZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgcGFnZS5vbmNlKFBhZ2UubmF2aWdhdGVkVG9FdmVudCwgY2xlYXJDYWxsYmFjayk7XG4gICAgfVxuXG4gICAgY29uc3QgbmF2aWdhdGlvbkVudHJ5OiBOYXZpZ2F0aW9uRW50cnkgPSB7XG4gICAgICBjcmVhdGUoKSB7XG4gICAgICAgIHJldHVybiBwYWdlO1xuICAgICAgfSxcbiAgICAgIGNvbnRleHQ6IG5hdmlnYXRpb25Db250ZXh0LFxuICAgICAgY2xlYXJIaXN0b3J5OiBuYXZPcHRpb25zLmNsZWFySGlzdG9yeSxcbiAgICAgIGFuaW1hdGVkOiBuYXZPcHRpb25zLmFuaW1hdGVkLFxuICAgICAgdHJhbnNpdGlvbjogbmF2T3B0aW9ucy50cmFuc2l0aW9uLFxuICAgIH07XG5cbiAgICBpZiAoaXNSZXBsYWNlICYmIHRoaXMuZnJhbWUuY3VycmVudFBhZ2UpIHtcbiAgICAgIHRoaXMuZnJhbWUucmVwbGFjZVBhZ2UobmF2aWdhdGlvbkVudHJ5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5mcmFtZS5uYXZpZ2F0ZShuYXZpZ2F0aW9uRW50cnkpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEZpbmQgYW5kIG1hcmsgdGhlIHRvcCBhY3RpdmF0ZWQgcm91dGUgYXMgYW4gYWN0aXZhdGVkIG9uZS5cbiAgLy8gSW4gbnMtbG9jYXRpb24tc3RyYXRlZ3kgd2UgYXJlIHJldXNpbmcgY29tcG9uZW50cyBvbmx5IGlmIHRoZWlyIGNvcnJlc3BvbmluZyByb3V0ZXNcbiAgLy8gYXJlIG1hcmtlZCBhcyBhY3RpdmF0ZWQgZnJvbSB0aGlzIG1ldGhvZC5cbiAgcHJpdmF0ZSBtYXJrQWN0aXZhdGVkUm91dGUoYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlKSB7XG4gICAgY29uc3QgcXVldWUgPSBbXTtcbiAgICBxdWV1ZS5wdXNoKGFjdGl2YXRlZFJvdXRlLnNuYXBzaG90KTtcbiAgICBsZXQgY3VycmVudFJvdXRlID0gcXVldWUuc2hpZnQoKTtcblxuICAgIHdoaWxlIChjdXJyZW50Um91dGUpIHtcbiAgICAgIGN1cnJlbnRSb3V0ZS5jaGlsZHJlbi5mb3JFYWNoKChjaGlsZFJvdXRlKSA9PiB7XG4gICAgICAgIHF1ZXVlLnB1c2goY2hpbGRSb3V0ZSk7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdG9wQWN0aXZhdGVkUm91dGUgPSBmaW5kVG9wQWN0aXZhdGVkUm91dGVOb2RlRm9yT3V0bGV0KGN1cnJlbnRSb3V0ZSk7XG4gICAgICBjb25zdCBvdXRsZXRLZXkgPSB0aGlzLmxvY2F0aW9uU3RyYXRlZ3kuZ2V0Um91dGVGdWxsUGF0aCh0b3BBY3RpdmF0ZWRSb3V0ZSk7XG4gICAgICBjb25zdCBvdXRsZXQgPSB0aGlzLmxvY2F0aW9uU3RyYXRlZ3kuZmluZE91dGxldChvdXRsZXRLZXksIHRvcEFjdGl2YXRlZFJvdXRlKTtcblxuICAgICAgaWYgKG91dGxldCAmJiBvdXRsZXQuZnJhbWVzLmxlbmd0aCkge1xuICAgICAgICB0b3BBY3RpdmF0ZWRSb3V0ZVtwYWdlUm91dGVyQWN0aXZhdGVkU3ltYm9sXSA9IHRydWU7XG4gICAgICAgIGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuICAgICAgICAgIE5hdGl2ZVNjcmlwdERlYnVnLnJvdXRlckxvZygnQWN0aXZhdGVkIHJvdXRlIG1hcmtlZCBhcyBwYWdlOiAnICsgcm91dGVUb1N0cmluZyh0b3BBY3RpdmF0ZWRSb3V0ZSkpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGN1cnJlbnRSb3V0ZSA9IHF1ZXVlLnNoaWZ0KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb21wb25lbnRUeXBlKGFjdGl2YXRlZFJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSk6IFR5cGU8YW55PiB7XG4gICAgcmV0dXJuIGFjdGl2YXRlZFJvdXRlLnJvdXRlQ29uZmlnLmNvbXBvbmVudCB8fCBhY3RpdmF0ZWRSb3V0ZS5jb21wb25lbnQ7XG4gIH1cblxuICBwcml2YXRlIGdldE91dGxldChhY3RpdmF0ZWRSb3V0ZVNuYXBzaG90OiBBY3RpdmF0ZWRSb3V0ZVNuYXBzaG90KTogT3V0bGV0IHtcbiAgICBjb25zdCB0b3BBY3RpdmF0ZWRSb3V0ZSA9IGZpbmRUb3BBY3RpdmF0ZWRSb3V0ZU5vZGVGb3JPdXRsZXQoYWN0aXZhdGVkUm91dGVTbmFwc2hvdCk7XG4gICAgY29uc3Qgb3V0bGV0S2V5ID0gdGhpcy5sb2NhdGlvblN0cmF0ZWd5LmdldFJvdXRlRnVsbFBhdGgodG9wQWN0aXZhdGVkUm91dGUpO1xuICAgIGxldCBvdXRsZXQgPSB0aGlzLmxvY2F0aW9uU3RyYXRlZ3kuZmluZE91dGxldChvdXRsZXRLZXksIHRvcEFjdGl2YXRlZFJvdXRlKTtcblxuICAgIC8vIE5hbWVkIGxhenkgbG9hZGVkIG91dGxldC5cbiAgICBpZiAoIW91dGxldCAmJiB0aGlzLmlzRW1wdHlPdXRsZXQpIHtcbiAgICAgIGNvbnN0IHBhcmVudE91dGxldEtleSA9IHRoaXMubG9jYXRpb25TdHJhdGVneS5nZXRSb3V0ZUZ1bGxQYXRoKHRvcEFjdGl2YXRlZFJvdXRlLnBhcmVudCk7XG4gICAgICBvdXRsZXQgPSB0aGlzLmxvY2F0aW9uU3RyYXRlZ3kuZmluZE91dGxldChwYXJlbnRPdXRsZXRLZXksIHRvcEFjdGl2YXRlZFJvdXRlLnBhcmVudCk7XG5cbiAgICAgIGlmIChvdXRsZXQpIHtcbiAgICAgICAgb3V0bGV0Lm91dGxldEtleXMucHVzaChvdXRsZXRLZXkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBvdXRsZXQ7XG4gIH1cbn1cbiJdfQ==