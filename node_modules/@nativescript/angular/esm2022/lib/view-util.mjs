import { unsetValue } from '@nativescript/core';
import { getViewClass, getViewMeta, isKnownView } from './element-registry';
import { CommentNode, isContentView, isDetachedElement, isInvisibleNode, isLayout, isView, TextNode } from './views';
import { NativeScriptDebug } from './trace';
// Note: this utility exists from deep core import however results in
// Module not found: Error: Can't resolve '@nativescript/core/ui/core/properties'
function isCssVariable(property) {
    return /^--[^,\s]+?$/.test(property);
}
const ELEMENT_NODE_TYPE = 1;
const XML_ATTRIBUTES = Object.freeze(['style', 'rows', 'columns', 'fontAttributes']);
const whiteSpaceSplitter = /\s+/;
function printNgTree(view) {
    let parent = view;
    while (parent.parent && parent.parent.firstChild) {
        parent = parent.parent;
    }
    printChildrenRecurse(parent);
}
function printChildrenRecurse(parent) {
    const children = parent.firstChild ? [parent.firstChild, ...getChildrenSiblings(parent.firstChild).nextSiblings] : [];
    console.log(`parent: ${parent}, firstChild: ${parent.firstChild}, lastChild: ${parent.lastChild} children: ${children}`);
    if (parent.firstChild) {
        console.log(`----- start ${parent}`);
    }
    children.forEach((c) => printChildrenRecurse(c));
    if (parent.firstChild) {
        console.log(`----- end ${parent}`);
    }
}
function getChildrenSiblings(view) {
    const nextSiblings = [];
    const previousSiblings = [];
    let sibling = view.nextSibling;
    while (sibling) {
        nextSiblings.push(sibling);
        sibling = sibling.nextSibling;
    }
    sibling = view.previousSibling;
    while (sibling) {
        previousSiblings.push(sibling);
        sibling = sibling.previousSibling;
    }
    return {
        previousSiblings,
        nextSiblings,
    };
}
function printSiblingsTree(view) {
    const { previousSiblings, nextSiblings } = getChildrenSiblings(view);
    console.log(`${view} previousSiblings: ${previousSiblings} nextSiblings: ${nextSiblings}`);
}
// eslint-disable-next-line @typescript-eslint/ban-types
const propertyMaps = new Map();
export class ViewUtil {
    constructor(namespaceFilters, reuseViews) {
        this.namespaceFilters = namespaceFilters;
        this.reuseViews = reuseViews;
    }
    /**
     * Inserts a child into a parrent, preferably before next.
     * @param parent parent view
     * @param child child view to be added
     * @param previous previous element. If present, insert after this.
     * @param next next element. If present, insert before this (previous is ignored).
     */
    insertChild(parent, child, previous, next) {
        if (!parent) {
            return;
        }
        const extendedParent = this.ensureNgViewExtensions(parent);
        const extendedChild = this.ensureNgViewExtensions(child);
        // this should never enter, as angular is supposed to remove the child from the previous parent before calling this
        // but when angular animations are enabled, the removal might be delayed, so we need to ensure this view is not anywhere
        // this seems to only happens to CommentNodes
        if (extendedChild.parentNode) {
            this.removeChild(extendedChild.parentNode, extendedChild);
        }
        // if there's a next child, previous is the previousSibling of it
        if (next) {
            previous = next.previousSibling;
        }
        else if (previous) {
            // if there's a previous, next is the nextSibling of it
            next = previous.nextSibling;
        }
        else {
            // no previous or next, append to the parent
            previous = extendedParent.lastChild; // this can still be undefined if the parent has no children!
        }
        this.insertInList(extendedParent, extendedChild, previous, next);
        if (isDetachedElement(child) || isInvisibleNode(child)) {
            extendedChild.parentNode = extendedParent;
        }
        if (!isDetachedElement(child)) {
            const nextVisual = this.findNextVisual(next);
            this.addToVisualTree(extendedParent, extendedChild, nextVisual);
        }
        else if (isInvisibleNode(extendedChild)) {
            const nextVisual = this.findNextVisual(next);
            this.addInvisibleNode(extendedParent, extendedChild, nextVisual);
        }
        // printNgTree(extendedChild);
    }
    insertBefore(parent, child, refChild) {
        const extendedRef = refChild ? this.ensureNgViewExtensions(refChild) : undefined;
        this.insertChild(parent, child, undefined, extendedRef);
    }
    insertAfter(parent, child, refChild) {
        const extendedRef = refChild ? this.ensureNgViewExtensions(refChild) : undefined;
        this.insertChild(parent, child, extendedRef);
    }
    appendChild(parent, child) {
        this.insertChild(parent, child);
    }
    /**
     * Inserts a view into the parent/sibling linked list
     * !WARNING: this method makes no checks to validate the integrity of previous/next children
     * @param parent parent view
     * @param child child view
     * @param previous previous element. null/undefined for first element
     * @param next next element. null/undefined for last element
     */
    insertInList(parent, child, previous, next) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.viewUtilLog(`ViewUtil.insertInList parent: ${parent}, view: ${child}, ` + `previous: ${previous}, next: ${next}`);
        }
        if (previous) {
            previous.nextSibling = child;
            child.previousSibling = previous;
        }
        else {
            parent.firstChild = child;
        }
        if (next) {
            child.nextSibling = next;
            next.previousSibling = child;
        }
        else {
            parent.lastChild = child;
        }
    }
    addToVisualTree(parent, child, next) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.viewUtilLog(`ViewUtil.addToVisualTree parent: ${parent}, view: ${child}, next: ${next}`);
        }
        if (parent.meta && parent.meta.insertChild) {
            parent.meta.insertChild(parent, child, next);
        }
        else if (isLayout(parent)) {
            this.insertToLayout(parent, child, next);
        }
        else if (isContentView(parent)) {
            parent.content = child;
        }
        else if (parent && parent._addChildFromBuilder) {
            parent._addChildFromBuilder(child.nodeName, child);
        }
    }
    addInvisibleNode(parent, child, next) {
        if (parent.meta?.insertInvisibleNode) {
            parent.meta.insertInvisibleNode(parent, child, next);
        }
        else {
            if (child instanceof TextNode) {
                parent.text = child.text;
                child.registerTextChange((t) => (parent.text = t), parent);
            }
        }
    }
    insertToLayout(parent, child, next) {
        if (child.parent === parent) {
            this.removeLayoutChild(parent, child);
        }
        const nextVisual = this.findNextVisual(next);
        if (nextVisual) {
            const index = parent.getChildIndex(nextVisual);
            parent.insertChild(child, index);
        }
        else {
            parent.addChild(child);
        }
        // parent.eachChild((c) => {console.log(c); return true});
    }
    findNextVisual(view) {
        let next = view;
        while (next && isDetachedElement(next)) {
            next = next.nextSibling;
        }
        return next;
    }
    removeChild(parent, child) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.viewUtilLog(`ViewUtil.removeChild parent: ${parent} child: ${child}`);
        }
        if (!parent) {
            return;
        }
        const extendedParent = this.ensureNgViewExtensions(parent);
        const extendedChild = this.ensureNgViewExtensions(child);
        extendedChild.parentNode = null;
        this.removeFromList(extendedParent, extendedChild);
        if (!isDetachedElement(extendedChild)) {
            this.removeFromVisualTree(extendedParent, extendedChild);
        }
        else if (isInvisibleNode(extendedChild)) {
            this.removeInvisibleNode(extendedParent, extendedChild);
        }
    }
    removeFromList(parent, child) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.viewUtilLog(`ViewUtil.removeFromList parent: ${parent} child: ${child}`);
        }
        // only child. null everything
        if (parent.firstChild === child && parent.lastChild === child) {
            parent.firstChild = null;
            parent.lastChild = null;
            child.nextSibling = null;
            child.previousSibling = null;
            return;
        }
        const previous = child.previousSibling;
        const next = child.nextSibling;
        // is first child, make the next sibling the first child (can be null)
        if (parent.firstChild === child) {
            parent.firstChild = next;
        }
        // is last child, make the previous sibling the last child (can be null)
        if (parent.lastChild === child) {
            parent.lastChild = previous;
        }
        // we have a previous sibling, make it point to the next sibling
        if (previous) {
            previous.nextSibling = next;
        }
        // we have a next sibling, make it point to the previous
        if (next) {
            next.previousSibling = previous;
        }
        // finally, null the siblings
        child.nextSibling = null;
        child.previousSibling = null;
    }
    // NOTE: This one is O(n) - use carefully
    findPreviousElement(parent, child) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.viewUtilLog(`ViewUtil.findPreviousElement parent: ${parent} child: ${child}`);
        }
        let previousVisual;
        if (isLayout(parent)) {
            previousVisual = this.getPreviousVisualElement(parent, child);
        }
        let previous = previousVisual || parent.firstChild;
        // since detached elements are not added to the visual tree,
        // we need to find the actual previous sibling of the view,
        // which may as well be an invisible node
        while (previous && previous !== child && previous.nextSibling !== child) {
            previous = previous.nextSibling;
        }
        return previous;
    }
    getPreviousVisualElement(parent, child) {
        const elementIndex = parent.getChildIndex(child);
        if (elementIndex > 0) {
            return parent.getChildAt(elementIndex - 1);
        }
    }
    // NOTE: This one is O(n) - use carefully
    getChildIndex(parent, child) {
        if (isLayout(parent)) {
            return parent.getChildIndex(child);
        }
        else if (isContentView(parent)) {
            return child === parent.content ? 0 : -1;
        }
    }
    removeFromVisualTree(parent, child) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.viewUtilLog(`ViewUtil.removeFromVisualTree parent: ${parent} child: ${child}`);
        }
        if (parent.meta && parent.meta.removeChild) {
            parent.meta.removeChild(parent, child);
        }
        else if (isLayout(parent)) {
            this.removeLayoutChild(parent, child);
        }
        else if (isContentView(parent) && parent.content === child) {
            parent.content = null;
        }
        else if (isView(parent)) {
            parent._removeView(child);
        }
    }
    removeInvisibleNode(parent, child) {
        if (parent.meta?.removeInvisibleNode) {
            parent.meta.removeInvisibleNode(parent, child);
        }
        else {
            if (child instanceof TextNode) {
                child.unregisterTextChange(parent);
            }
        }
    }
    removeLayoutChild(parent, child) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.viewUtilLog(`ViewUtil.removeLayoutChild parent: ${parent} child: ${child}`);
        }
        const index = parent.getChildIndex(child);
        if (index !== -1) {
            parent.removeChild(child);
        }
    }
    createComment(value) {
        return new CommentNode(value);
    }
    createText(value) {
        return new TextNode(value);
    }
    createView(name) {
        const originalName = name;
        if (!isKnownView(name)) {
            name = 'ProxyViewContainer';
        }
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.viewUtilLog(`Creating view: ${originalName} ${name}`);
        }
        const viewClass = getViewClass(name);
        const view = new viewClass();
        const ngView = this.setNgViewExtensions(view, name);
        ngView.reusable = !!this.reuseViews;
        return ngView;
    }
    ensureNgViewExtensions(view) {
        if (Object.hasOwnProperty.call(view, 'meta')) {
            return view;
        }
        else {
            const name = view.cssType || view.typeName;
            const ngView = this.setNgViewExtensions(view, name);
            return ngView;
        }
    }
    setNgViewExtensions(view, name) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.viewUtilLog(`Make into a NgView view: ${view} name: "${name}"`);
        }
        const ngView = view;
        ngView.nodeName = name;
        ngView.meta = getViewMeta(name);
        // we're setting the node type of the view
        // to 'element' because of checks done in the
        // dom animation engine
        ngView.nodeType = ELEMENT_NODE_TYPE;
        return ngView;
    }
    setProperty(view, attributeName, value, namespace) {
        if (!view || (namespace && !this.runsIn(namespace))) {
            return;
        }
        if (attributeName.indexOf('.') !== -1) {
            // Handle nested properties
            const properties = attributeName.split('.');
            attributeName = properties[properties.length - 1];
            let propMap = this.getProperties(view);
            let i = 0;
            while (i < properties.length - 1 && typeof view !== 'undefined') {
                let prop = properties[i];
                if (propMap.has(prop)) {
                    prop = propMap.get(prop);
                }
                view = view[prop];
                propMap = this.getProperties(view);
                i++;
            }
        }
        if (typeof view !== 'undefined') {
            this.setPropertyInternal(view, attributeName, value);
        }
    }
    runsIn(platform) {
        let runs = true;
        const last = () => true;
        if (this.namespaceFilters) {
            let chain = (p) => true;
            for (let i = this.namespaceFilters.length - 1; i >= 0; i--) {
                const currentChain = chain;
                chain = (p) => this.namespaceFilters[i].runsIn(p, currentChain);
            }
            runs = chain(platform);
            runs = runs !== false ? true : false; // undefined means true
            // this.namespaceFilters.some((filter) => {
            // 	const runsInFilter = filter.runsIn(platform);
            // 	if (runsInFilter !== undefined) {
            // 		runs = runsInFilter;
            // 		return true;
            // 	}
            // });
        }
        return runs;
    }
    setPropertyInternal(view, attributeName, value) {
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.viewUtilLog(`Setting attribute: ${attributeName}=${value} to ${view}`);
        }
        if (attributeName === 'class') {
            this.setClasses(view, value);
            return;
        }
        if (XML_ATTRIBUTES.indexOf(attributeName) !== -1) {
            view[attributeName] = value;
            return;
        }
        const propMap = this.getProperties(view);
        const propertyName = propMap.get(attributeName);
        // Ensure the children of a collection currently have no parent set.
        if (Array.isArray(value)) {
            this.removeParentReferencesFromItems(value);
        }
        if (propertyName) {
            // We have a lower-upper case mapped property.
            view[propertyName] = value;
            return;
        }
        // Unknown attribute value -- just set it to our object as is.
        view[attributeName] = value;
    }
    removeParentReferencesFromItems(items) {
        for (const item of items) {
            if (item.parent && item.parentNode) {
                if (NativeScriptDebug.isLogEnabled()) {
                    NativeScriptDebug.viewUtilLog(`Unassigning parent ${item.parentNode} on value: ${item}`);
                }
                item.parent = undefined;
                item.parentNode = undefined;
            }
        }
    }
    getProperties(instance) {
        const type = instance && instance.constructor;
        if (!type) {
            return new Map();
        }
        if (!propertyMaps.has(type)) {
            const propMap = new Map();
            for (const propName in instance) {
                // tslint:disable:forin
                propMap.set(propName.toLowerCase(), propName);
            }
            propertyMaps.set(type, propMap);
        }
        return propertyMaps.get(type);
    }
    cssClasses(view) {
        if (!view.ngCssClasses) {
            view.ngCssClasses = new Map();
        }
        return view.ngCssClasses;
    }
    addClass(view, className) {
        const extendedView = this.ensureNgViewExtensions(view);
        this.cssClasses(extendedView).set(className, true);
        this.syncClasses(extendedView);
    }
    removeClass(view, className) {
        const extendedView = this.ensureNgViewExtensions(view);
        this.cssClasses(extendedView).delete(className);
        this.syncClasses(extendedView);
    }
    setClasses(view, classesValue) {
        const classes = classesValue.split(whiteSpaceSplitter);
        this.cssClasses(view).clear();
        classes.forEach((className) => this.cssClasses(view).set(className, true));
        this.syncClasses(view);
    }
    syncClasses(view) {
        const classValue = Array.from(this.cssClasses(view).keys()).join(' ');
        view.className = classValue;
    }
    setStyle(view, styleName, value) {
        if (isCssVariable(styleName)) {
            view.style.setUnscopedCssVariable(styleName, value);
            view._onCssStateChange();
        }
        else {
            view.style[styleName] = value;
        }
    }
    removeStyle(view, styleName) {
        if (isCssVariable(styleName)) {
            // TODO: expose this on core
            view.style.unscopedCssVariables.delete(styleName);
            view._onCssStateChange();
        }
        else {
            view.style[styleName] = unsetValue;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlldy11dGlsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvYW5ndWxhci9zcmMvbGliL3ZpZXctdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFRLE1BQU0sb0JBQW9CLENBQUM7QUFDdEQsT0FBTyxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsV0FBVyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFNUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxhQUFhLEVBQUUsaUJBQWlCLEVBQUUsZUFBZSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQVUsUUFBUSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRTdILE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUc1QyxxRUFBcUU7QUFDckUsaUZBQWlGO0FBQ2pGLFNBQVMsYUFBYSxDQUFDLFFBQWdCO0lBQ3JDLE9BQU8sY0FBYyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUN2QyxDQUFDO0FBRUQsTUFBTSxpQkFBaUIsR0FBRyxDQUFDLENBQUM7QUFDNUIsTUFBTSxjQUFjLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixDQUFDLENBQUMsQ0FBQztBQUNyRixNQUFNLGtCQUFrQixHQUFHLEtBQUssQ0FBQztBQUlqQyxTQUFTLFdBQVcsQ0FBQyxJQUFZO0lBQy9CLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQztJQUNsQixPQUFPLE1BQU0sQ0FBQyxNQUFNLElBQUssTUFBTSxDQUFDLE1BQWlCLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDN0QsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFnQixDQUFDO0lBQ25DLENBQUM7SUFDRCxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMvQixDQUFDO0FBQ0QsU0FBUyxvQkFBb0IsQ0FB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QUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsR0FBRyxVQUFVLENBQUM7UUFDckMsQ0FBQztJQUNILENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVuc2V0VmFsdWUsIFZpZXcgfSBmcm9tICdAbmF0aXZlc2NyaXB0L2NvcmUnO1xuaW1wb3J0IHsgZ2V0Vmlld0NsYXNzLCBnZXRWaWV3TWV0YSwgaXNLbm93blZpZXcgfSBmcm9tICcuL2VsZW1lbnQtcmVnaXN0cnknO1xuaW1wb3J0IHsgTmFtZXNwYWNlRmlsdGVyIH0gZnJvbSAnLi9wcm9wZXJ0eS1maWx0ZXInO1xuaW1wb3J0IHsgQ29tbWVudE5vZGUsIGlzQ29udGVudFZpZXcsIGlzRGV0YWNoZWRFbGVtZW50LCBpc0ludmlzaWJsZU5vZGUsIGlzTGF5b3V0LCBpc1ZpZXcsIE5nVmlldywgVGV4dE5vZGUgfSBmcm9tICcuL3ZpZXdzJztcblxuaW1wb3J0IHsgTmF0aXZlU2NyaXB0RGVidWcgfSBmcm9tICcuL3RyYWNlJztcbmltcG9ydCB7IE5nTGF5b3V0QmFzZSB9IGZyb20gJy4vdmlld3Mvdmlldy10eXBlcyc7XG5cbi8vIE5vdGU6IHRoaXMgdXRpbGl0eSBleGlzdHMgZnJvbSBkZWVwIGNvcmUgaW1wb3J0IGhvd2V2ZXIgcmVzdWx0cyBpblxuLy8gTW9kdWxlIG5vdCBmb3VuZDogRXJyb3I6IENhbid0IHJlc29sdmUgJ0BuYXRpdmVzY3JpcHQvY29yZS91aS9jb3JlL3Byb3BlcnRpZXMnXG5mdW5jdGlvbiBpc0Nzc1ZhcmlhYmxlKHByb3BlcnR5OiBzdHJpbmcpIHtcbiAgcmV0dXJuIC9eLS1bXixcXHNdKz8kLy50ZXN0KHByb3BlcnR5KTtcbn1cblxuY29uc3QgRUxFTUVOVF9OT0RFX1RZUEUgPSAxO1xuY29uc3QgWE1MX0FUVFJJQlVURVMgPSBPYmplY3QuZnJlZXplKFsnc3R5bGUnLCAncm93cycsICdjb2x1bW5zJywgJ2ZvbnRBdHRyaWJ1dGVzJ10pO1xuY29uc3Qgd2hpdGVTcGFjZVNwbGl0dGVyID0gL1xccysvO1xuXG5leHBvcnQgdHlwZSBCZWZvcmVBdHRhY2hBY3Rpb24gPSAodmlldzogVmlldykgPT4gdm9pZDtcblxuZnVuY3Rpb24gcHJpbnROZ1RyZWUodmlldzogTmdWaWV3KSB7XG4gIGxldCBwYXJlbnQgPSB2aWV3O1xuICB3aGlsZSAocGFyZW50LnBhcmVudCAmJiAocGFyZW50LnBhcmVudCBhcyBOZ1ZpZXcpLmZpcnN0Q2hpbGQpIHtcbiAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50IGFzIE5nVmlldztcbiAgfVxuICBwcmludENoaWxkcmVuUmVjdXJzZShwYXJlbnQpO1xufVxuZnVuY3Rpb24gcHJpbnRDaGlsZHJlblJlY3Vyc2UocGFyZW50OiBOZ1ZpZXcpIHtcbiAgY29uc3QgY2hpbGRyZW4gPSBwYXJlbnQuZmlyc3RDaGlsZCA/IFtwYXJlbnQuZmlyc3RDaGlsZCwgLi4uZ2V0Q2hpbGRyZW5TaWJsaW5ncyhwYXJlbnQuZmlyc3RDaGlsZCkubmV4dFNpYmxpbmdzXSA6IFtdO1xuICBjb25zb2xlLmxvZyhgcGFyZW50OiAke3BhcmVudH0sIGZpcnN0Q2hpbGQ6ICR7cGFyZW50LmZpcnN0Q2hpbGR9LCBsYXN0Q2hpbGQ6ICR7cGFyZW50Lmxhc3RDaGlsZH0gY2hpbGRyZW46ICR7Y2hpbGRyZW59YCk7XG4gIGlmIChwYXJlbnQuZmlyc3RDaGlsZCkge1xuICAgIGNvbnNvbGUubG9nKGAtLS0tLSBzdGFydCAke3BhcmVudH1gKTtcbiAgfVxuICBjaGlsZHJlbi5mb3JFYWNoKChjKSA9PiBwcmludENoaWxkcmVuUmVjdXJzZShjKSk7XG4gIGlmIChwYXJlbnQuZmlyc3RDaGlsZCkge1xuICAgIGNvbnNvbGUubG9nKGAtLS0tLSBlbmQgJHtwYXJlbnR9YCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0Q2hpbGRyZW5TaWJsaW5ncyh2aWV3OiBOZ1ZpZXcpIHtcbiAgY29uc3QgbmV4dFNpYmxpbmdzID0gW107XG4gIGNvbnN0IHByZXZpb3VzU2libGluZ3MgPSBbXTtcbiAgbGV0IHNpYmxpbmcgPSB2aWV3Lm5leHRTaWJsaW5nO1xuICB3aGlsZSAoc2libGluZykge1xuICAgIG5leHRTaWJsaW5ncy5wdXNoKHNpYmxpbmcpO1xuICAgIHNpYmxpbmcgPSBzaWJsaW5nLm5leHRTaWJsaW5nO1xuICB9XG4gIHNpYmxpbmcgPSB2aWV3LnByZXZpb3VzU2libGluZztcbiAgd2hpbGUgKHNpYmxpbmcpIHtcbiAgICBwcmV2aW91c1NpYmxpbmdzLnB1c2goc2libGluZyk7XG4gICAgc2libGluZyA9IHNpYmxpbmcucHJldmlvdXNTaWJsaW5nO1xuICB9XG4gIHJldHVybiB7XG4gICAgcHJldmlvdXNTaWJsaW5ncyxcbiAgICBuZXh0U2libGluZ3MsXG4gIH07XG59XG5cbmZ1bmN0aW9uIHByaW50U2libGluZ3NUcmVlKHZpZXc6IE5nVmlldykge1xuICBjb25zdCB7IHByZXZpb3VzU2libGluZ3MsIG5leHRTaWJsaW5ncyB9ID0gZ2V0Q2hpbGRyZW5TaWJsaW5ncyh2aWV3KTtcbiAgY29uc29sZS5sb2coYCR7dmlld30gcHJldmlvdXNTaWJsaW5nczogJHtwcmV2aW91c1NpYmxpbmdzfSBuZXh0U2libGluZ3M6ICR7bmV4dFNpYmxpbmdzfWApO1xufVxuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10eXBlc1xuY29uc3QgcHJvcGVydHlNYXBzOiBNYXA8RnVuY3Rpb24sIE1hcDxzdHJpbmcsIHN0cmluZz4+ID0gbmV3IE1hcDxGdW5jdGlvbiwgTWFwPHN0cmluZywgc3RyaW5nPj4oKTtcblxuZXhwb3J0IGNsYXNzIFZpZXdVdGlsIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBuYW1lc3BhY2VGaWx0ZXJzPzogTmFtZXNwYWNlRmlsdGVyW10sIHByaXZhdGUgcmV1c2VWaWV3cz86IGJvb2xlYW4pIHt9XG4gIC8qKlxuICAgKiBJbnNlcnRzIGEgY2hpbGQgaW50byBhIHBhcnJlbnQsIHByZWZlcmFibHkgYmVmb3JlIG5leHQuXG4gICAqIEBwYXJhbSBwYXJlbnQgcGFyZW50IHZpZXdcbiAgICogQHBhcmFtIGNoaWxkIGNoaWxkIHZpZXcgdG8gYmUgYWRkZWRcbiAgICogQHBhcmFtIHByZXZpb3VzIHByZXZpb3VzIGVsZW1lbnQuIElmIHByZXNlbnQsIGluc2VydCBhZnRlciB0aGlzLlxuICAgKiBAcGFyYW0gbmV4dCBuZXh0IGVsZW1lbnQuIElmIHByZXNlbnQsIGluc2VydCBiZWZvcmUgdGhpcyAocHJldmlvdXMgaXMgaWdub3JlZCkuXG4gICAqL1xuICBwcml2YXRlIGluc2VydENoaWxkKHBhcmVudDogVmlldywgY2hpbGQ6IFZpZXcsIHByZXZpb3VzPzogTmdWaWV3LCBuZXh0PzogTmdWaWV3KSB7XG4gICAgaWYgKCFwYXJlbnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBleHRlbmRlZFBhcmVudCA9IHRoaXMuZW5zdXJlTmdWaWV3RXh0ZW5zaW9ucyhwYXJlbnQpO1xuICAgIGNvbnN0IGV4dGVuZGVkQ2hpbGQgPSB0aGlzLmVuc3VyZU5nVmlld0V4dGVuc2lvbnMoY2hpbGQpO1xuXG4gICAgLy8gdGhpcyBzaG91bGQgbmV2ZXIgZW50ZXIsIGFzIGFuZ3VsYXIgaXMgc3VwcG9zZWQgdG8gcmVtb3ZlIHRoZSBjaGlsZCBmcm9tIHRoZSBwcmV2aW91cyBwYXJlbnQgYmVmb3JlIGNhbGxpbmcgdGhpc1xuICAgIC8vIGJ1dCB3aGVuIGFuZ3VsYXIgYW5pbWF0aW9ucyBhcmUgZW5hYmxlZCwgdGhlIHJlbW92YWwgbWlnaHQgYmUgZGVsYXllZCwgc28gd2UgbmVlZCB0byBlbnN1cmUgdGhpcyB2aWV3IGlzIG5vdCBhbnl3aGVyZVxuICAgIC8vIHRoaXMgc2VlbXMgdG8gb25seSBoYXBwZW5zIHRvIENvbW1lbnROb2Rlc1xuICAgIGlmIChleHRlbmRlZENoaWxkLnBhcmVudE5vZGUpIHtcbiAgICAgIHRoaXMucmVtb3ZlQ2hpbGQoZXh0ZW5kZWRDaGlsZC5wYXJlbnROb2RlLCBleHRlbmRlZENoaWxkKTtcbiAgICB9XG4gICAgLy8gaWYgdGhlcmUncyBhIG5leHQgY2hpbGQsIHByZXZpb3VzIGlzIHRoZSBwcmV2aW91c1NpYmxpbmcgb2YgaXRcbiAgICBpZiAobmV4dCkge1xuICAgICAgcHJldmlvdXMgPSBuZXh0LnByZXZpb3VzU2libGluZztcbiAgICB9IGVsc2UgaWYgKHByZXZpb3VzKSB7XG4gICAgICAvLyBpZiB0aGVyZSdzIGEgcHJldmlvdXMsIG5leHQgaXMgdGhlIG5leHRTaWJsaW5nIG9mIGl0XG4gICAgICBuZXh0ID0gcHJldmlvdXMubmV4dFNpYmxpbmc7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIG5vIHByZXZpb3VzIG9yIG5leHQsIGFwcGVuZCB0byB0aGUgcGFyZW50XG4gICAgICBwcmV2aW91cyA9IGV4dGVuZGVkUGFyZW50Lmxhc3RDaGlsZDsgLy8gdGhpcyBjYW4gc3RpbGwgYmUgdW5kZWZpbmVkIGlmIHRoZSBwYXJlbnQgaGFzIG5vIGNoaWxkcmVuIVxuICAgIH1cbiAgICB0aGlzLmluc2VydEluTGlzdChleHRlbmRlZFBhcmVudCwgZXh0ZW5kZWRDaGlsZCwgcHJldmlvdXMsIG5leHQpO1xuXG4gICAgaWYgKGlzRGV0YWNoZWRFbGVtZW50KGNoaWxkKSB8fCBpc0ludmlzaWJsZU5vZGUoY2hpbGQpKSB7XG4gICAgICBleHRlbmRlZENoaWxkLnBhcmVudE5vZGUgPSBleHRlbmRlZFBhcmVudDtcbiAgICB9XG5cbiAgICBpZiAoIWlzRGV0YWNoZWRFbGVtZW50KGNoaWxkKSkge1xuICAgICAgY29uc3QgbmV4dFZpc3VhbCA9IHRoaXMuZmluZE5leHRWaXN1YWwobmV4dCk7XG4gICAgICB0aGlzLmFkZFRvVmlzdWFsVHJlZShleHRlbmRlZFBhcmVudCwgZXh0ZW5kZWRDaGlsZCwgbmV4dFZpc3VhbCk7XG4gICAgfSBlbHNlIGlmIChpc0ludmlzaWJsZU5vZGUoZXh0ZW5kZWRDaGlsZCkpIHtcbiAgICAgIGNvbnN0IG5leHRWaXN1YWwgPSB0aGlzLmZpbmROZXh0VmlzdWFsKG5leHQpO1xuICAgICAgdGhpcy5hZGRJbnZpc2libGVOb2RlKGV4dGVuZGVkUGFyZW50LCBleHRlbmRlZENoaWxkLCBuZXh0VmlzdWFsKTtcbiAgICB9XG4gICAgLy8gcHJpbnROZ1RyZWUoZXh0ZW5kZWRDaGlsZCk7XG4gIH1cblxuICBwdWJsaWMgaW5zZXJ0QmVmb3JlKHBhcmVudDogVmlldywgY2hpbGQ6IFZpZXcsIHJlZkNoaWxkPzogVmlldyB8IE5nVmlldykge1xuICAgIGNvbnN0IGV4dGVuZGVkUmVmID0gcmVmQ2hpbGQgPyB0aGlzLmVuc3VyZU5nVmlld0V4dGVuc2lvbnMocmVmQ2hpbGQpIDogdW5kZWZpbmVkO1xuICAgIHRoaXMuaW5zZXJ0Q2hpbGQocGFyZW50LCBjaGlsZCwgdW5kZWZpbmVkLCBleHRlbmRlZFJlZik7XG4gIH1cbiAgcHVibGljIGluc2VydEFmdGVyKHBhcmVudDogVmlldywgY2hpbGQ6IFZpZXcsIHJlZkNoaWxkPzogVmlldyB8IE5nVmlldykge1xuICAgIGNvbnN0IGV4dGVuZGVkUmVmID0gcmVmQ2hpbGQgPyB0aGlzLmVuc3VyZU5nVmlld0V4dGVuc2lvbnMocmVmQ2hpbGQpIDogdW5kZWZpbmVkO1xuICAgIHRoaXMuaW5zZXJ0Q2hpbGQocGFyZW50LCBjaGlsZCwgZXh0ZW5kZWRSZWYpO1xuICB9XG5cbiAgcHVibGljIGFwcGVuZENoaWxkKHBhcmVudDogVmlldywgY2hpbGQ6IFZpZXcpIHtcbiAgICB0aGlzLmluc2VydENoaWxkKHBhcmVudCwgY2hpbGQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEluc2VydHMgYSB2aWV3IGludG8gdGhlIHBhcmVudC9zaWJsaW5nIGxpbmtlZCBsaXN0XG4gICAqICFXQVJOSU5HOiB0aGlzIG1ldGhvZCBtYWtlcyBubyBjaGVja3MgdG8gdmFsaWRhdGUgdGhlIGludGVncml0eSBvZiBwcmV2aW91cy9uZXh0IGNoaWxkcmVuXG4gICAqIEBwYXJhbSBwYXJlbnQgcGFyZW50IHZpZXdcbiAgICogQHBhcmFtIGNoaWxkIGNoaWxkIHZpZXdcbiAgICogQHBhcmFtIHByZXZpb3VzIHByZXZpb3VzIGVsZW1lbnQuIG51bGwvdW5kZWZpbmVkIGZvciBmaXJzdCBlbGVtZW50XG4gICAqIEBwYXJhbSBuZXh0IG5leHQgZWxlbWVudC4gbnVsbC91bmRlZmluZWQgZm9yIGxhc3QgZWxlbWVudFxuICAgKi9cbiAgcHJpdmF0ZSBpbnNlcnRJbkxpc3QocGFyZW50OiBOZ1ZpZXcsIGNoaWxkOiBOZ1ZpZXcsIHByZXZpb3VzOiBOZ1ZpZXcsIG5leHQ6IE5nVmlldyk6IHZvaWQge1xuICAgIGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuICAgICAgTmF0aXZlU2NyaXB0RGVidWcudmlld1V0aWxMb2coYFZpZXdVdGlsLmluc2VydEluTGlzdCBwYXJlbnQ6ICR7cGFyZW50fSwgdmlldzogJHtjaGlsZH0sIGAgKyBgcHJldmlvdXM6ICR7cHJldmlvdXN9LCBuZXh0OiAke25leHR9YCk7XG4gICAgfVxuXG4gICAgaWYgKHByZXZpb3VzKSB7XG4gICAgICBwcmV2aW91cy5uZXh0U2libGluZyA9IGNoaWxkO1xuICAgICAgY2hpbGQucHJldmlvdXNTaWJsaW5nID0gcHJldmlvdXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBhcmVudC5maXJzdENoaWxkID0gY2hpbGQ7XG4gICAgfVxuXG4gICAgaWYgKG5leHQpIHtcbiAgICAgIGNoaWxkLm5leHRTaWJsaW5nID0gbmV4dDtcbiAgICAgIG5leHQucHJldmlvdXNTaWJsaW5nID0gY2hpbGQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBhcmVudC5sYXN0Q2hpbGQgPSBjaGlsZDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFkZFRvVmlzdWFsVHJlZShwYXJlbnQ6IE5nVmlldywgY2hpbGQ6IE5nVmlldywgbmV4dDogTmdWaWV3KTogdm9pZCB7XG4gICAgaWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG4gICAgICBOYXRpdmVTY3JpcHREZWJ1Zy52aWV3VXRpbExvZyhgVmlld1V0aWwuYWRkVG9WaXN1YWxUcmVlIHBhcmVudDogJHtwYXJlbnR9LCB2aWV3OiAke2NoaWxkfSwgbmV4dDogJHtuZXh0fWApO1xuICAgIH1cblxuICAgIGlmIChwYXJlbnQubWV0YSAmJiBwYXJlbnQubWV0YS5pbnNlcnRDaGlsZCkge1xuICAgICAgcGFyZW50Lm1ldGEuaW5zZXJ0Q2hpbGQocGFyZW50LCBjaGlsZCwgbmV4dCk7XG4gICAgfSBlbHNlIGlmIChpc0xheW91dChwYXJlbnQpKSB7XG4gICAgICB0aGlzLmluc2VydFRvTGF5b3V0KHBhcmVudCwgY2hpbGQsIG5leHQpO1xuICAgIH0gZWxzZSBpZiAoaXNDb250ZW50VmlldyhwYXJlbnQpKSB7XG4gICAgICBwYXJlbnQuY29udGVudCA9IGNoaWxkO1xuICAgIH0gZWxzZSBpZiAocGFyZW50ICYmICg8YW55PnBhcmVudCkuX2FkZENoaWxkRnJvbUJ1aWxkZXIpIHtcbiAgICAgICg8YW55PnBhcmVudCkuX2FkZENoaWxkRnJvbUJ1aWxkZXIoY2hpbGQubm9kZU5hbWUsIGNoaWxkKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFkZEludmlzaWJsZU5vZGUocGFyZW50OiBOZ1ZpZXcsIGNoaWxkOiBOZ1ZpZXcsIG5leHQ6IE5nVmlldyk6IHZvaWQge1xuICAgIGlmIChwYXJlbnQubWV0YT8uaW5zZXJ0SW52aXNpYmxlTm9kZSkge1xuICAgICAgcGFyZW50Lm1ldGEuaW5zZXJ0SW52aXNpYmxlTm9kZShwYXJlbnQsIGNoaWxkLCBuZXh0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgVGV4dE5vZGUpIHtcbiAgICAgICAgKHBhcmVudCBhcyBhbnkpLnRleHQgPSBjaGlsZC50ZXh0O1xuICAgICAgICBjaGlsZC5yZWdpc3RlclRleHRDaGFuZ2UoKHQpID0+ICgocGFyZW50IGFzIGFueSkudGV4dCA9IHQpLCBwYXJlbnQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaW5zZXJ0VG9MYXlvdXQocGFyZW50OiBOZ0xheW91dEJhc2UsIGNoaWxkOiBOZ1ZpZXcsIG5leHQ6IE5nVmlldyk6IHZvaWQge1xuICAgIGlmIChjaGlsZC5wYXJlbnQgPT09IHBhcmVudCkge1xuICAgICAgdGhpcy5yZW1vdmVMYXlvdXRDaGlsZChwYXJlbnQsIGNoaWxkKTtcbiAgICB9XG5cbiAgICBjb25zdCBuZXh0VmlzdWFsID0gdGhpcy5maW5kTmV4dFZpc3VhbChuZXh0KTtcbiAgICBpZiAobmV4dFZpc3VhbCkge1xuICAgICAgY29uc3QgaW5kZXggPSBwYXJlbnQuZ2V0Q2hpbGRJbmRleChuZXh0VmlzdWFsKTtcbiAgICAgIHBhcmVudC5pbnNlcnRDaGlsZChjaGlsZCwgaW5kZXgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXJlbnQuYWRkQ2hpbGQoY2hpbGQpO1xuICAgIH1cbiAgICAvLyBwYXJlbnQuZWFjaENoaWxkKChjKSA9PiB7Y29uc29sZS5sb2coYyk7IHJldHVybiB0cnVlfSk7XG4gIH1cblxuICBwcml2YXRlIGZpbmROZXh0VmlzdWFsKHZpZXc6IE5nVmlldyk6IE5nVmlldyB7XG4gICAgbGV0IG5leHQgPSB2aWV3O1xuICAgIHdoaWxlIChuZXh0ICYmIGlzRGV0YWNoZWRFbGVtZW50KG5leHQpKSB7XG4gICAgICBuZXh0ID0gbmV4dC5uZXh0U2libGluZztcbiAgICB9XG5cbiAgICByZXR1cm4gbmV4dDtcbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVDaGlsZChwYXJlbnQ6IFZpZXcsIGNoaWxkOiBWaWV3KSB7XG4gICAgaWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG4gICAgICBOYXRpdmVTY3JpcHREZWJ1Zy52aWV3VXRpbExvZyhgVmlld1V0aWwucmVtb3ZlQ2hpbGQgcGFyZW50OiAke3BhcmVudH0gY2hpbGQ6ICR7Y2hpbGR9YCk7XG4gICAgfVxuXG4gICAgaWYgKCFwYXJlbnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBleHRlbmRlZFBhcmVudCA9IHRoaXMuZW5zdXJlTmdWaWV3RXh0ZW5zaW9ucyhwYXJlbnQpO1xuICAgIGNvbnN0IGV4dGVuZGVkQ2hpbGQgPSB0aGlzLmVuc3VyZU5nVmlld0V4dGVuc2lvbnMoY2hpbGQpO1xuICAgIGV4dGVuZGVkQ2hpbGQucGFyZW50Tm9kZSA9IG51bGw7XG5cbiAgICB0aGlzLnJlbW92ZUZyb21MaXN0KGV4dGVuZGVkUGFyZW50LCBleHRlbmRlZENoaWxkKTtcbiAgICBpZiAoIWlzRGV0YWNoZWRFbGVtZW50KGV4dGVuZGVkQ2hpbGQpKSB7XG4gICAgICB0aGlzLnJlbW92ZUZyb21WaXN1YWxUcmVlKGV4dGVuZGVkUGFyZW50LCBleHRlbmRlZENoaWxkKTtcbiAgICB9IGVsc2UgaWYgKGlzSW52aXNpYmxlTm9kZShleHRlbmRlZENoaWxkKSkge1xuICAgICAgdGhpcy5yZW1vdmVJbnZpc2libGVOb2RlKGV4dGVuZGVkUGFyZW50LCBleHRlbmRlZENoaWxkKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUZyb21MaXN0KHBhcmVudDogTmdWaWV3LCBjaGlsZDogTmdWaWV3KSB7XG4gICAgaWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG4gICAgICBOYXRpdmVTY3JpcHREZWJ1Zy52aWV3VXRpbExvZyhgVmlld1V0aWwucmVtb3ZlRnJvbUxpc3QgcGFyZW50OiAke3BhcmVudH0gY2hpbGQ6ICR7Y2hpbGR9YCk7XG4gICAgfVxuXG4gICAgLy8gb25seSBjaGlsZC4gbnVsbCBldmVyeXRoaW5nXG4gICAgaWYgKHBhcmVudC5maXJzdENoaWxkID09PSBjaGlsZCAmJiBwYXJlbnQubGFzdENoaWxkID09PSBjaGlsZCkge1xuICAgICAgcGFyZW50LmZpcnN0Q2hpbGQgPSBudWxsO1xuICAgICAgcGFyZW50Lmxhc3RDaGlsZCA9IG51bGw7XG4gICAgICBjaGlsZC5uZXh0U2libGluZyA9IG51bGw7XG4gICAgICBjaGlsZC5wcmV2aW91c1NpYmxpbmcgPSBudWxsO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHByZXZpb3VzID0gY2hpbGQucHJldmlvdXNTaWJsaW5nO1xuICAgIGNvbnN0IG5leHQgPSBjaGlsZC5uZXh0U2libGluZztcbiAgICAvLyBpcyBmaXJzdCBjaGlsZCwgbWFrZSB0aGUgbmV4dCBzaWJsaW5nIHRoZSBmaXJzdCBjaGlsZCAoY2FuIGJlIG51bGwpXG4gICAgaWYgKHBhcmVudC5maXJzdENoaWxkID09PSBjaGlsZCkge1xuICAgICAgcGFyZW50LmZpcnN0Q2hpbGQgPSBuZXh0O1xuICAgIH1cblxuICAgIC8vIGlzIGxhc3QgY2hpbGQsIG1ha2UgdGhlIHByZXZpb3VzIHNpYmxpbmcgdGhlIGxhc3QgY2hpbGQgKGNhbiBiZSBudWxsKVxuICAgIGlmIChwYXJlbnQubGFzdENoaWxkID09PSBjaGlsZCkge1xuICAgICAgcGFyZW50Lmxhc3RDaGlsZCA9IHByZXZpb3VzO1xuICAgIH1cblxuICAgIC8vIHdlIGhhdmUgYSBwcmV2aW91cyBzaWJsaW5nLCBtYWtlIGl0IHBvaW50IHRvIHRoZSBuZXh0IHNpYmxpbmdcbiAgICBpZiAocHJldmlvdXMpIHtcbiAgICAgIHByZXZpb3VzLm5leHRTaWJsaW5nID0gbmV4dDtcbiAgICB9XG5cbiAgICAvLyB3ZSBoYXZlIGEgbmV4dCBzaWJsaW5nLCBtYWtlIGl0IHBvaW50IHRvIHRoZSBwcmV2aW91c1xuICAgIGlmIChuZXh0KSB7XG4gICAgICBuZXh0LnByZXZpb3VzU2libGluZyA9IHByZXZpb3VzO1xuICAgIH1cblxuICAgIC8vIGZpbmFsbHksIG51bGwgdGhlIHNpYmxpbmdzXG4gICAgY2hpbGQubmV4dFNpYmxpbmcgPSBudWxsO1xuICAgIGNoaWxkLnByZXZpb3VzU2libGluZyA9IG51bGw7XG4gIH1cblxuICAvLyBOT1RFOiBUaGlzIG9uZSBpcyBPKG4pIC0gdXNlIGNhcmVmdWxseVxuICBwcml2YXRlIGZpbmRQcmV2aW91c0VsZW1lbnQocGFyZW50OiBOZ1ZpZXcsIGNoaWxkOiBOZ1ZpZXcpOiBOZ1ZpZXcge1xuICAgIGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuICAgICAgTmF0aXZlU2NyaXB0RGVidWcudmlld1V0aWxMb2coYFZpZXdVdGlsLmZpbmRQcmV2aW91c0VsZW1lbnQgcGFyZW50OiAke3BhcmVudH0gY2hpbGQ6ICR7Y2hpbGR9YCk7XG4gICAgfVxuXG4gICAgbGV0IHByZXZpb3VzVmlzdWFsO1xuICAgIGlmIChpc0xheW91dChwYXJlbnQpKSB7XG4gICAgICBwcmV2aW91c1Zpc3VhbCA9IHRoaXMuZ2V0UHJldmlvdXNWaXN1YWxFbGVtZW50KHBhcmVudCwgY2hpbGQpO1xuICAgIH1cblxuICAgIGxldCBwcmV2aW91cyA9IHByZXZpb3VzVmlzdWFsIHx8IHBhcmVudC5maXJzdENoaWxkO1xuXG4gICAgLy8gc2luY2UgZGV0YWNoZWQgZWxlbWVudHMgYXJlIG5vdCBhZGRlZCB0byB0aGUgdmlzdWFsIHRyZWUsXG4gICAgLy8gd2UgbmVlZCB0byBmaW5kIHRoZSBhY3R1YWwgcHJldmlvdXMgc2libGluZyBvZiB0aGUgdmlldyxcbiAgICAvLyB3aGljaCBtYXkgYXMgd2VsbCBiZSBhbiBpbnZpc2libGUgbm9kZVxuICAgIHdoaWxlIChwcmV2aW91cyAmJiBwcmV2aW91cyAhPT0gY2hpbGQgJiYgcHJldmlvdXMubmV4dFNpYmxpbmcgIT09IGNoaWxkKSB7XG4gICAgICBwcmV2aW91cyA9IHByZXZpb3VzLm5leHRTaWJsaW5nO1xuICAgIH1cblxuICAgIHJldHVybiBwcmV2aW91cztcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UHJldmlvdXNWaXN1YWxFbGVtZW50KHBhcmVudDogTmdMYXlvdXRCYXNlLCBjaGlsZDogTmdWaWV3KTogTmdWaWV3IHtcbiAgICBjb25zdCBlbGVtZW50SW5kZXggPSBwYXJlbnQuZ2V0Q2hpbGRJbmRleChjaGlsZCk7XG5cbiAgICBpZiAoZWxlbWVudEluZGV4ID4gMCkge1xuICAgICAgcmV0dXJuIHBhcmVudC5nZXRDaGlsZEF0KGVsZW1lbnRJbmRleCAtIDEpIGFzIE5nVmlldztcbiAgICB9XG4gIH1cblxuICAvLyBOT1RFOiBUaGlzIG9uZSBpcyBPKG4pIC0gdXNlIGNhcmVmdWxseVxuICBwdWJsaWMgZ2V0Q2hpbGRJbmRleChwYXJlbnQ6IGFueSwgY2hpbGQ6IE5nVmlldykge1xuICAgIGlmIChpc0xheW91dChwYXJlbnQpKSB7XG4gICAgICByZXR1cm4gcGFyZW50LmdldENoaWxkSW5kZXgoY2hpbGQpO1xuICAgIH0gZWxzZSBpZiAoaXNDb250ZW50VmlldyhwYXJlbnQpKSB7XG4gICAgICByZXR1cm4gY2hpbGQgPT09IHBhcmVudC5jb250ZW50ID8gMCA6IC0xO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlRnJvbVZpc3VhbFRyZWUocGFyZW50OiBOZ1ZpZXcsIGNoaWxkOiBOZ1ZpZXcpIHtcbiAgICBpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcbiAgICAgIE5hdGl2ZVNjcmlwdERlYnVnLnZpZXdVdGlsTG9nKGBWaWV3VXRpbC5yZW1vdmVGcm9tVmlzdWFsVHJlZSBwYXJlbnQ6ICR7cGFyZW50fSBjaGlsZDogJHtjaGlsZH1gKTtcbiAgICB9XG5cbiAgICBpZiAocGFyZW50Lm1ldGEgJiYgcGFyZW50Lm1ldGEucmVtb3ZlQ2hpbGQpIHtcbiAgICAgIHBhcmVudC5tZXRhLnJlbW92ZUNoaWxkKHBhcmVudCwgY2hpbGQpO1xuICAgIH0gZWxzZSBpZiAoaXNMYXlvdXQocGFyZW50KSkge1xuICAgICAgdGhpcy5yZW1vdmVMYXlvdXRDaGlsZChwYXJlbnQsIGNoaWxkKTtcbiAgICB9IGVsc2UgaWYgKGlzQ29udGVudFZpZXcocGFyZW50KSAmJiBwYXJlbnQuY29udGVudCA9PT0gY2hpbGQpIHtcbiAgICAgIHBhcmVudC5jb250ZW50ID0gbnVsbDtcbiAgICB9IGVsc2UgaWYgKGlzVmlldyhwYXJlbnQpKSB7XG4gICAgICBwYXJlbnQuX3JlbW92ZVZpZXcoY2hpbGQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlSW52aXNpYmxlTm9kZShwYXJlbnQ6IE5nVmlldywgY2hpbGQ6IE5nVmlldykge1xuICAgIGlmIChwYXJlbnQubWV0YT8ucmVtb3ZlSW52aXNpYmxlTm9kZSkge1xuICAgICAgcGFyZW50Lm1ldGEucmVtb3ZlSW52aXNpYmxlTm9kZShwYXJlbnQsIGNoaWxkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgVGV4dE5vZGUpIHtcbiAgICAgICAgY2hpbGQudW5yZWdpc3RlclRleHRDaGFuZ2UocGFyZW50KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUxheW91dENoaWxkKHBhcmVudDogTmdMYXlvdXRCYXNlLCBjaGlsZDogTmdWaWV3KTogdm9pZCB7XG4gICAgaWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG4gICAgICBOYXRpdmVTY3JpcHREZWJ1Zy52aWV3VXRpbExvZyhgVmlld1V0aWwucmVtb3ZlTGF5b3V0Q2hpbGQgcGFyZW50OiAke3BhcmVudH0gY2hpbGQ6ICR7Y2hpbGR9YCk7XG4gICAgfVxuXG4gICAgY29uc3QgaW5kZXggPSBwYXJlbnQuZ2V0Q2hpbGRJbmRleChjaGlsZCk7XG5cbiAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICBwYXJlbnQucmVtb3ZlQ2hpbGQoY2hpbGQpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGVDb21tZW50KHZhbHVlOiBzdHJpbmcpOiBDb21tZW50Tm9kZSB7XG4gICAgcmV0dXJuIG5ldyBDb21tZW50Tm9kZSh2YWx1ZSk7XG4gIH1cblxuICBwdWJsaWMgY3JlYXRlVGV4dCh2YWx1ZTogc3RyaW5nKTogVGV4dE5vZGUge1xuICAgIHJldHVybiBuZXcgVGV4dE5vZGUodmFsdWUpO1xuICB9XG5cbiAgcHVibGljIGNyZWF0ZVZpZXcobmFtZTogc3RyaW5nKTogTmdWaWV3IHtcbiAgICBjb25zdCBvcmlnaW5hbE5hbWUgPSBuYW1lO1xuICAgIGlmICghaXNLbm93blZpZXcobmFtZSkpIHtcbiAgICAgIG5hbWUgPSAnUHJveHlWaWV3Q29udGFpbmVyJztcbiAgICB9XG5cbiAgICBpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcbiAgICAgIE5hdGl2ZVNjcmlwdERlYnVnLnZpZXdVdGlsTG9nKGBDcmVhdGluZyB2aWV3OiAke29yaWdpbmFsTmFtZX0gJHtuYW1lfWApO1xuICAgIH1cblxuICAgIGNvbnN0IHZpZXdDbGFzcyA9IGdldFZpZXdDbGFzcyhuYW1lKTtcbiAgICBjb25zdCB2aWV3ID0gPE5nVmlldz5uZXcgdmlld0NsYXNzKCk7XG4gICAgY29uc3QgbmdWaWV3ID0gdGhpcy5zZXROZ1ZpZXdFeHRlbnNpb25zKHZpZXcsIG5hbWUpO1xuICAgIG5nVmlldy5yZXVzYWJsZSA9ICEhdGhpcy5yZXVzZVZpZXdzO1xuXG4gICAgcmV0dXJuIG5nVmlldztcbiAgfVxuXG4gIHByaXZhdGUgZW5zdXJlTmdWaWV3RXh0ZW5zaW9ucyh2aWV3OiBWaWV3KTogTmdWaWV3IHtcbiAgICBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwodmlldywgJ21ldGEnKSkge1xuICAgICAgcmV0dXJuIHZpZXcgYXMgTmdWaWV3O1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBuYW1lID0gdmlldy5jc3NUeXBlIHx8IHZpZXcudHlwZU5hbWU7XG4gICAgICBjb25zdCBuZ1ZpZXcgPSB0aGlzLnNldE5nVmlld0V4dGVuc2lvbnModmlldywgbmFtZSk7XG5cbiAgICAgIHJldHVybiBuZ1ZpZXc7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXROZ1ZpZXdFeHRlbnNpb25zKHZpZXc6IFZpZXcsIG5hbWU6IHN0cmluZyk6IE5nVmlldyB7XG4gICAgaWYgKE5hdGl2ZVNjcmlwdERlYnVnLmlzTG9nRW5hYmxlZCgpKSB7XG4gICAgICBOYXRpdmVTY3JpcHREZWJ1Zy52aWV3VXRpbExvZyhgTWFrZSBpbnRvIGEgTmdWaWV3IHZpZXc6ICR7dmlld30gbmFtZTogXCIke25hbWV9XCJgKTtcbiAgICB9XG5cbiAgICBjb25zdCBuZ1ZpZXcgPSB2aWV3IGFzIE5nVmlldztcbiAgICBuZ1ZpZXcubm9kZU5hbWUgPSBuYW1lO1xuICAgIG5nVmlldy5tZXRhID0gZ2V0Vmlld01ldGEobmFtZSk7XG5cbiAgICAvLyB3ZSdyZSBzZXR0aW5nIHRoZSBub2RlIHR5cGUgb2YgdGhlIHZpZXdcbiAgICAvLyB0byAnZWxlbWVudCcgYmVjYXVzZSBvZiBjaGVja3MgZG9uZSBpbiB0aGVcbiAgICAvLyBkb20gYW5pbWF0aW9uIGVuZ2luZVxuICAgIG5nVmlldy5ub2RlVHlwZSA9IEVMRU1FTlRfTk9ERV9UWVBFO1xuXG4gICAgcmV0dXJuIG5nVmlldztcbiAgfVxuXG4gIHB1YmxpYyBzZXRQcm9wZXJ0eSh2aWV3OiBOZ1ZpZXcsIGF0dHJpYnV0ZU5hbWU6IHN0cmluZywgdmFsdWU6IGFueSwgbmFtZXNwYWNlPzogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKCF2aWV3IHx8IChuYW1lc3BhY2UgJiYgIXRoaXMucnVuc0luKG5hbWVzcGFjZSkpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGF0dHJpYnV0ZU5hbWUuaW5kZXhPZignLicpICE9PSAtMSkge1xuICAgICAgLy8gSGFuZGxlIG5lc3RlZCBwcm9wZXJ0aWVzXG4gICAgICBjb25zdCBwcm9wZXJ0aWVzID0gYXR0cmlidXRlTmFtZS5zcGxpdCgnLicpO1xuICAgICAgYXR0cmlidXRlTmFtZSA9IHByb3BlcnRpZXNbcHJvcGVydGllcy5sZW5ndGggLSAxXTtcblxuICAgICAgbGV0IHByb3BNYXAgPSB0aGlzLmdldFByb3BlcnRpZXModmlldyk7XG4gICAgICBsZXQgaSA9IDA7XG4gICAgICB3aGlsZSAoaSA8IHByb3BlcnRpZXMubGVuZ3RoIC0gMSAmJiB0eXBlb2YgdmlldyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgbGV0IHByb3AgPSBwcm9wZXJ0aWVzW2ldO1xuICAgICAgICBpZiAocHJvcE1hcC5oYXMocHJvcCkpIHtcbiAgICAgICAgICBwcm9wID0gcHJvcE1hcC5nZXQocHJvcCk7XG4gICAgICAgIH1cblxuICAgICAgICB2aWV3ID0gdmlld1twcm9wXTtcbiAgICAgICAgcHJvcE1hcCA9IHRoaXMuZ2V0UHJvcGVydGllcyh2aWV3KTtcbiAgICAgICAgaSsrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdmlldyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRoaXMuc2V0UHJvcGVydHlJbnRlcm5hbCh2aWV3LCBhdHRyaWJ1dGVOYW1lLCB2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBydW5zSW4ocGxhdGZvcm06IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGxldCBydW5zID0gdHJ1ZTtcbiAgICBjb25zdCBsYXN0ID0gKCkgPT4gdHJ1ZTtcbiAgICBpZiAodGhpcy5uYW1lc3BhY2VGaWx0ZXJzKSB7XG4gICAgICBsZXQgY2hhaW4gPSAocDogc3RyaW5nKSA9PiB0cnVlO1xuICAgICAgZm9yIChsZXQgaSA9IHRoaXMubmFtZXNwYWNlRmlsdGVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICBjb25zdCBjdXJyZW50Q2hhaW4gPSBjaGFpbjtcbiAgICAgICAgY2hhaW4gPSAocCkgPT4gdGhpcy5uYW1lc3BhY2VGaWx0ZXJzW2ldLnJ1bnNJbihwLCBjdXJyZW50Q2hhaW4pO1xuICAgICAgfVxuICAgICAgcnVucyA9IGNoYWluKHBsYXRmb3JtKTtcbiAgICAgIHJ1bnMgPSBydW5zICE9PSBmYWxzZSA/IHRydWUgOiBmYWxzZTsgLy8gdW5kZWZpbmVkIG1lYW5zIHRydWVcbiAgICAgIC8vIHRoaXMubmFtZXNwYWNlRmlsdGVycy5zb21lKChmaWx0ZXIpID0+IHtcbiAgICAgIC8vIFx0Y29uc3QgcnVuc0luRmlsdGVyID0gZmlsdGVyLnJ1bnNJbihwbGF0Zm9ybSk7XG4gICAgICAvLyBcdGlmIChydW5zSW5GaWx0ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gXHRcdHJ1bnMgPSBydW5zSW5GaWx0ZXI7XG4gICAgICAvLyBcdFx0cmV0dXJuIHRydWU7XG4gICAgICAvLyBcdH1cbiAgICAgIC8vIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcnVucztcbiAgfVxuXG4gIHByaXZhdGUgc2V0UHJvcGVydHlJbnRlcm5hbCh2aWV3OiBOZ1ZpZXcsIGF0dHJpYnV0ZU5hbWU6IHN0cmluZywgdmFsdWU6IGFueSk6IHZvaWQge1xuICAgIGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuICAgICAgTmF0aXZlU2NyaXB0RGVidWcudmlld1V0aWxMb2coYFNldHRpbmcgYXR0cmlidXRlOiAke2F0dHJpYnV0ZU5hbWV9PSR7dmFsdWV9IHRvICR7dmlld31gKTtcbiAgICB9XG5cbiAgICBpZiAoYXR0cmlidXRlTmFtZSA9PT0gJ2NsYXNzJykge1xuICAgICAgdGhpcy5zZXRDbGFzc2VzKHZpZXcsIHZhbHVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoWE1MX0FUVFJJQlVURVMuaW5kZXhPZihhdHRyaWJ1dGVOYW1lKSAhPT0gLTEpIHtcbiAgICAgIHZpZXdbYXR0cmlidXRlTmFtZV0gPSB2YWx1ZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBwcm9wTWFwID0gdGhpcy5nZXRQcm9wZXJ0aWVzKHZpZXcpO1xuICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHByb3BNYXAuZ2V0KGF0dHJpYnV0ZU5hbWUpO1xuXG4gICAgLy8gRW5zdXJlIHRoZSBjaGlsZHJlbiBvZiBhIGNvbGxlY3Rpb24gY3VycmVudGx5IGhhdmUgbm8gcGFyZW50IHNldC5cbiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgIHRoaXMucmVtb3ZlUGFyZW50UmVmZXJlbmNlc0Zyb21JdGVtcyh2YWx1ZSk7XG4gICAgfVxuXG4gICAgaWYgKHByb3BlcnR5TmFtZSkge1xuICAgICAgLy8gV2UgaGF2ZSBhIGxvd2VyLXVwcGVyIGNhc2UgbWFwcGVkIHByb3BlcnR5LlxuICAgICAgdmlld1twcm9wZXJ0eU5hbWVdID0gdmFsdWU7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gVW5rbm93biBhdHRyaWJ1dGUgdmFsdWUgLS0ganVzdCBzZXQgaXQgdG8gb3VyIG9iamVjdCBhcyBpcy5cbiAgICB2aWV3W2F0dHJpYnV0ZU5hbWVdID0gdmFsdWU7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZVBhcmVudFJlZmVyZW5jZXNGcm9tSXRlbXMoaXRlbXM6IGFueVtdKTogdm9pZCB7XG4gICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKSB7XG4gICAgICBpZiAoaXRlbS5wYXJlbnQgJiYgaXRlbS5wYXJlbnROb2RlKSB7XG4gICAgICAgIGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuICAgICAgICAgIE5hdGl2ZVNjcmlwdERlYnVnLnZpZXdVdGlsTG9nKGBVbmFzc2lnbmluZyBwYXJlbnQgJHtpdGVtLnBhcmVudE5vZGV9IG9uIHZhbHVlOiAke2l0ZW19YCk7XG4gICAgICAgIH1cbiAgICAgICAgaXRlbS5wYXJlbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIGl0ZW0ucGFyZW50Tm9kZSA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFByb3BlcnRpZXMoaW5zdGFuY2U6IGFueSk6IE1hcDxzdHJpbmcsIHN0cmluZz4ge1xuICAgIGNvbnN0IHR5cGUgPSBpbnN0YW5jZSAmJiBpbnN0YW5jZS5jb25zdHJ1Y3RvcjtcbiAgICBpZiAoIXR5cGUpIHtcbiAgICAgIHJldHVybiBuZXcgTWFwPHN0cmluZywgc3RyaW5nPigpO1xuICAgIH1cblxuICAgIGlmICghcHJvcGVydHlNYXBzLmhhcyh0eXBlKSkge1xuICAgICAgY29uc3QgcHJvcE1hcCA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XG4gICAgICBmb3IgKGNvbnN0IHByb3BOYW1lIGluIGluc3RhbmNlKSB7XG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlOmZvcmluXG4gICAgICAgIHByb3BNYXAuc2V0KHByb3BOYW1lLnRvTG93ZXJDYXNlKCksIHByb3BOYW1lKTtcbiAgICAgIH1cbiAgICAgIHByb3BlcnR5TWFwcy5zZXQodHlwZSwgcHJvcE1hcCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHByb3BlcnR5TWFwcy5nZXQodHlwZSk7XG4gIH1cblxuICBwcml2YXRlIGNzc0NsYXNzZXModmlldzogTmdWaWV3KSB7XG4gICAgaWYgKCF2aWV3Lm5nQ3NzQ2xhc3Nlcykge1xuICAgICAgdmlldy5uZ0Nzc0NsYXNzZXMgPSBuZXcgTWFwPHN0cmluZywgYm9vbGVhbj4oKTtcbiAgICB9XG4gICAgcmV0dXJuIHZpZXcubmdDc3NDbGFzc2VzO1xuICB9XG5cbiAgcHVibGljIGFkZENsYXNzKHZpZXc6IFZpZXcgfCBOZ1ZpZXcsIGNsYXNzTmFtZTogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3QgZXh0ZW5kZWRWaWV3ID0gdGhpcy5lbnN1cmVOZ1ZpZXdFeHRlbnNpb25zKHZpZXcpO1xuICAgIHRoaXMuY3NzQ2xhc3NlcyhleHRlbmRlZFZpZXcpLnNldChjbGFzc05hbWUsIHRydWUpO1xuICAgIHRoaXMuc3luY0NsYXNzZXMoZXh0ZW5kZWRWaWV3KTtcbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVDbGFzcyh2aWV3OiBWaWV3LCBjbGFzc05hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGV4dGVuZGVkVmlldyA9IHRoaXMuZW5zdXJlTmdWaWV3RXh0ZW5zaW9ucyh2aWV3KTtcbiAgICB0aGlzLmNzc0NsYXNzZXMoZXh0ZW5kZWRWaWV3KS5kZWxldGUoY2xhc3NOYW1lKTtcbiAgICB0aGlzLnN5bmNDbGFzc2VzKGV4dGVuZGVkVmlldyk7XG4gIH1cblxuICBwcml2YXRlIHNldENsYXNzZXModmlldzogTmdWaWV3LCBjbGFzc2VzVmFsdWU6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGNsYXNzZXMgPSBjbGFzc2VzVmFsdWUuc3BsaXQod2hpdGVTcGFjZVNwbGl0dGVyKTtcbiAgICB0aGlzLmNzc0NsYXNzZXModmlldykuY2xlYXIoKTtcbiAgICBjbGFzc2VzLmZvckVhY2goKGNsYXNzTmFtZSkgPT4gdGhpcy5jc3NDbGFzc2VzKHZpZXcpLnNldChjbGFzc05hbWUsIHRydWUpKTtcbiAgICB0aGlzLnN5bmNDbGFzc2VzKHZpZXcpO1xuICB9XG5cbiAgcHJpdmF0ZSBzeW5jQ2xhc3Nlcyh2aWV3OiBOZ1ZpZXcpOiB2b2lkIHtcbiAgICBjb25zdCBjbGFzc1ZhbHVlID0gKDxhbnk+QXJyYXkpLmZyb20odGhpcy5jc3NDbGFzc2VzKHZpZXcpLmtleXMoKSkuam9pbignICcpO1xuICAgIHZpZXcuY2xhc3NOYW1lID0gY2xhc3NWYWx1ZTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRTdHlsZSh2aWV3OiBWaWV3LCBzdHlsZU5hbWU6IHN0cmluZywgdmFsdWU6IGFueSkge1xuICAgIGlmIChpc0Nzc1ZhcmlhYmxlKHN0eWxlTmFtZSkpIHtcbiAgICAgIHZpZXcuc3R5bGUuc2V0VW5zY29wZWRDc3NWYXJpYWJsZShzdHlsZU5hbWUsIHZhbHVlKTtcbiAgICAgIHZpZXcuX29uQ3NzU3RhdGVDaGFuZ2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmlldy5zdHlsZVtzdHlsZU5hbWVdID0gdmFsdWU7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHJlbW92ZVN0eWxlKHZpZXc6IFZpZXcsIHN0eWxlTmFtZTogc3RyaW5nKSB7XG4gICAgaWYgKGlzQ3NzVmFyaWFibGUoc3R5bGVOYW1lKSkge1xuICAgICAgLy8gVE9ETzogZXhwb3NlIHRoaXMgb24gY29yZVxuICAgICAgKHZpZXcuc3R5bGUgYXMgYW55KS51bnNjb3BlZENzc1ZhcmlhYmxlcy5kZWxldGUoc3R5bGVOYW1lKTtcbiAgICAgIHZpZXcuX29uQ3NzU3RhdGVDaGFuZ2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmlldy5zdHlsZVtzdHlsZU5hbWVdID0gdW5zZXRWYWx1ZTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==